
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Flavours based on Browser Version - My Delusional Dream</title>
  <meta name="author" content="Patrick Wagstrom">

  
  <meta name="description" content="Flavours Based on Browser Version Oct 26th, 2003 | var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://patrick.wagstrom.net/weblog/2003/10/26/browserflavour">
  <link href="/weblog/favicon.png" rel="icon">
  <link href="/weblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/weblog/javascripts/modernizr-2.0.js"></script>
  <script src="/weblog/javascripts/ender.js"></script>
  <script src="/weblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/weblog/atom.xml" rel="alternate" title="My Delusional Dream" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/weblog/">My Delusional Dream</a></h1>
  
    <h2>Thoughts of a cautious technocrat</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/weblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:patrick.wagstrom.net/weblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/weblog/">Blog</a></li>
  <li><a href="/weblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Flavours Based on Browser Version</h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-10-26T22:41:00-05:00" pubdate data-updated="true">Oct 26<span>th</span>, 2003</time>
        
        
         | 

<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<script type="text/javascript" src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script>


        
      </p>
    
  </header>


<div class="entry-content"><p>Okay, so I&#8217;ve got an XML/XSLT version of my weblog that I&#8217;ve been working on.
I would like for the XML/XSLT version to be the default for browsers like
Mozilla and Firebird while retaining the HTML version for the rest of my
website.  However, Pyblosxom doesn&#8217;t allow this.  Until now!  There were a few
steps to this project that needed to be completed.  The first was stopping
Pyblosxom from escaping out > and &lt; when sending out content type of
&#8220;text/xml&#8221;.  That&#8217;s what this patch is for:</p>

<pre><code>--- /home/patrick/src/pyblosxom-0.8.1/Pyblosxom/renderers/blosxom.py    Fri Sep 26 00:57:31 2003
+++ blosxom.py  Sun Oct 26 19:00:39 2003
@@ -117,12 +117,13 @@

         output = []

-        if re.search(r'\Wxml', data['content-type']):
-            quotes = {"'":"'", '"':"""}
-            entry['title'] = escape(entry['title'],quotes)
-            entry.setData(escape(entry.getData(),quotes))
+        # if re.search(r'\Wxml', data['content-type']):
+            # quotes = {"'":"&amp;apos;", '"':"&amp;quot;"}
+            # entry['title'] = escape(entry['title'],quotes)
+            # entry.setData(escape(entry.getData(),quotes))

-        elif data['content-type'] == 'text/plain':
+        # elif data['content-type'] == 'text/plain':
+        if data['content-type'] == 'text/plain':
             s = tools.Stripper()
             s.feed(entry.getData())
             s.close()
</code></pre>

<p>As you can see, this just comments out the old functionality, so it&#8217;s easy
enough to replace if you need it at a later time.  The other step was to allow
a lookup of the appropriate default flavor.  Here&#8217;s the patch that allows that:</p>

<pre><code>--- /home/patrick/src/pyblosxom-0.8.1/Pyblosxom/pyblosxom.py    Wed Aug  6 18:40:25 2003
+++ ../Pyblosxom/pyblosxom.py   Sun Oct 26 21:32:40 2003
@@ -144,11 +144,29 @@

         return valid_list

+    def browserSpecificFlavour(self,args):
+        """
+        Allow for specific default flavors based on the version of the browser.
+
+        @param args: dict containing the incoming Request object
+        @type args: L{Pyblosxom.Request.Request}
+        """
+        request = args['request']
+        config = request.getConfiguration()
+        pyhttp = request.getHttp()
+        flavourREs = config.get('browserFlavour', [])
+        userAgent = pyhttp['HTTP_USER_AGENT']
+        for x in flavourREs:
+            matchobj = re.search(x[0],userAgent)
+            if matchobj:
+                return x[1]
+        return None
+
     def processPathInfo(self, args):
         """
         Process HTTP PATH_INFO for URI according to path specifications, fill in
         data dict accordingly
-
+
         The paths specification looks like this:
             - C{/cat} - category
             - C{/2002} - year
@@ -167,14 +185,15 @@

         form = self._request.getHttp()["form"]
         data['flavour'] = (form.has_key('flav') and
-                form['flav'].value or
+                form['flav'].value or
+                self.browserSpecificFlavour(args) or
                 config.get('defaultFlavour', 'html'))

         path_info = []
         data['pi_yr'] = ''
         data['pi_mo'] = ''
         data['pi_da'] = ''
-
+
         if pyhttp.get('PATH_INFO', ''):
             path_info = pyhttp['PATH_INFO'].split('/')
         path_info = [x for x in path_info if x != '']
</code></pre>

<p>There are a few spots there where the patch could be tightened because I got
rid of some spaces, but oh well, too late now.  Now the final step is to add
the lines to your config.py file to support all of this.  Here is the lines
that I have to make the defaultFlavour &#8220;html&#8221; and have newer version of Mozilla
use &#8220;xml&#8221;.  Basically, this looks at the user agent of the browser, and if
&#8220;rv:1.4&#8221; or greater is found, the it returns the default as XML.</p>

<pre><code>py['defaultFlavour'] = 'html'
py['browserFlavour'] = [ ['rv:1.[4-9]','xml'] ]
</code></pre>

<p>Unfortunately, right now this only works on the main page for the browser.  I&#8217;m
working on a way to have it change links and always spit out XML/XSLT.  When
that happens I&#8217;ll post it to this category too.  Happy Hacking!</p>
</div>


<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>




  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Patrick Wagstrom</span></span>

      








  


<time datetime="2003-10-26T22:41:00-05:00" pubdate data-updated="true">Oct 26<span>th</span>, 2003</time>
      

<span class="categories">
  
    <a class='category' href='/weblog/blog/categories/meta/'>meta</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://patrick.wagstrom.net/weblog/2003/10/26/browserflavour/" data-via="pridkett" data-counturl="http://patrick.wagstrom.net/weblog/2003/10/26/browserflavour/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/weblog/2003/10/26/firstentry/" title="Previous Post: First pyblosxom Entry">&laquo; First pyblosxom Entry</a>
      
      
        <a class="basic-alignment right" href="/weblog/2003/10/27/xmlcalendarintro/" title="Next Post: XMLCalendar pyBlosxom Plugin">XMLCalendar pyBlosxom Plugin &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/weblog/2012/05/10/static-bloggin/">Static Bloggin</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/28/i-am-not-a-climatologist-and-neither-are-most-of-these-people/">I am not a climatologist, and neither are most of these people</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/10/looking-for-summer-interns-in-the-software-technology-group-at-ibm-tj-watson-research-center/">Looking for Summer Interns in the Software Technology Group at IBM TJ Watson Research Center</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/a-review-of-2011-personal-development-goals/">A Review of 2011 Personal Development Goals</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/open-source-and-technology-predictions-for-2012/">Open Source and Technology Predictions for 2012</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/pridkett">@pridkett</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pridkett',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/weblog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("pridkett", 4, false);
    });
  </script>
  <script src="/weblog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/pridkett" class="twitter-follow-button" data-show-count="false">Follow @pridkett</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102672530623465237388?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Patrick Wagstrom -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
