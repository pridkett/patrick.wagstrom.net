
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tracks Behind Apache With Non-Proxied Static Content - My Delusional Dream</title>
  <meta name="author" content="Patrick Wagstrom">

  
  <meta name="description" content="Tracks Behind Apache With Non-Proxied Static Content Jul 30th, 2006 | var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://patrick.wagstrom.net/weblog/2006/07/30/tracks-behind-apache-static">
  <link href="/weblog/favicon.png" rel="icon">
  <link href="/weblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/weblog/javascripts/modernizr-2.0.js"></script>
  <script src="/weblog/javascripts/ender.js"></script>
  <script src="/weblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/weblog/atom.xml" rel="alternate" title="My Delusional Dream" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/weblog/">My Delusional Dream</a></h1>
  
    <h2>Thoughts of a cautious technocrat</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/weblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:patrick.wagstrom.net/weblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/weblog/">Blog</a></li>
  <li><a href="/weblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Tracks Behind Apache With Non-Proxied Static Content</h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-30T14:30:00-04:00" pubdate data-updated="true">Jul 30<span>th</span>, 2006</time>
        
        
         | 

<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<script type="text/javascript" src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script>


        
      </p>
    
  </header>


<div class="entry-content"><p>In my <a href="/weblog/weblog/web/tracks-behind-apache.xml">previous post on setting up Tracks and Ruby on Rails to run behind an Apache proxy</a>, there was a bit of symlink hokerey  hat one had to do to make it serve the static content properly.  What if we didn&#8217;t have to do that?  What if we could get by with only adding the line:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>    <span class="no">ActionController</span><span class="o">::</span><span class="no">AbstractRequest</span><span class="o">.</span><span class="n">relative_url_root</span> <span class="o">=</span> <span class="s2">&quot;/tracks&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>To your ~/tracks/config/environment.rb file?  Wouldn&#8217;t that just be grand?  What if we could go beyond that and make Apache serve up all the static content?  It&#8217;s one less component to break while proxying requests back and forth.  Well, we can.</p>

<p>In additon to the ability of ProxyPass statements to direct requests to a remote proxy, they can also be used to deny certain URLs from a proxy.  That&#8217;s the technique that we&#8217;ll be using here.  Previously, the configuration section of interest
looked like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'>
</span><span class='line'>    <span class="nb">RewriteEngine</span> <span class="k">on</span>
</span><span class='line'>    <span class="nb">RewriteRule</span> ^/tracks$ https://secure.wagstrom.net/tracks/ [R,L]
</span><span class='line'>    <span class="nb">ProxyPass</span> <span class="sx">/tracks/</span> http://127.0.0.1:3000/tracks/
</span><span class='line'>    <span class="nb">ProxyPassReverse</span> <span class="sx">/tracks/</span> http://127.0.0.1:3000/tracks/
</span><span class='line'>    <span class="nb">ProxyPreserveHost</span> <span class="k">on</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we just add in some lines to Apache to let it know what URLs not to proxy and how to handle those urls.  Just change the section so it now appears as follows:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'>    <span class="nb">RewriteEngine</span> <span class="k">on</span>
</span><span class='line'>    <span class="nb">RewriteRule</span> ^/tracks$ https://secure.wagstrom.net/tracks/ [R,L]
</span><span class='line'>
</span><span class='line'>    <span class="nb">RequestHeader</span> set X_FORWARDED_PROTO &#39;https&#39;
</span><span class='line'>
</span><span class='line'>    <span class="nb">ProxyPass</span> <span class="sx">/tracks/images</span> !
</span><span class='line'>    <span class="nb">ProxyPass</span> <span class="sx">/tracks/stylesheets</span> !
</span><span class='line'>    <span class="nb">ProxyPass</span> <span class="sx">/tracks/javascripts</span> !
</span><span class='line'>    <span class="nb">ProxyPass</span> <span class="sx">/tracks/favicon.ico</span> !
</span><span class='line'>    <span class="nb">Alias</span> <span class="sx">/tracks</span> <span class="s2">&quot;/home/patrick/tracks/public/&quot;</span>
</span><span class='line'>    <span class="nt">&lt;Directory</span> <span class="s">/home/patrick/tracks/public/</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nb">Options</span> FollowSymLinks
</span><span class='line'>      <span class="nb">Allow</span> from <span class="k">all</span>
</span><span class='line'>      <span class="nb">Order</span> allow,deny
</span><span class='line'>    <span class="nt">&lt;/Directory&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">ProxyPass</span> <span class="sx">/tracks/</span> http://127.0.0.1:3000/tracks/
</span><span class='line'>    <span class="nb">ProxyPassReverse</span> <span class="sx">/tracks/</span> http://127.0.0.1:3000/tracks/
</span><span class='line'>    <span class="nb">ProxyPreserveHost</span> <span class="k">on</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first four ProxyPass statements tell Apache not to proxy requests to /tracks/images, /tracks/stylesheets, /tracks/javascripts, and /tracks/favicon.ico.  The next six lines make it so Apache actually knows how to serve the static content.  You&#8217;ll obviously want to replace /home/patrick/tracks/public with wherever your location of the Tracks public data is.  Now, restart Apache and you should have Apache serving the static content and Rails serving the dynamic content.  Awesome.</p>
</div>


<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>




  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Patrick Wagstrom</span></span>

      








  


<time datetime="2006-07-30T14:30:00-04:00" pubdate data-updated="true">Jul 30<span>th</span>, 2006</time>
      

<span class="categories">
  
    <a class='category' href='/weblog/blog/categories/web/'>web</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://patrick.wagstrom.net/weblog/2006/07/30/tracks-behind-apache-static/" data-via="pridkett" data-counturl="http://patrick.wagstrom.net/weblog/2006/07/30/tracks-behind-apache-static/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/weblog/2006/07/29/tracks-behind-apache/" title="Previous Post: Tracks behind an Apache 2 Proxy on OpenBSD">&laquo; Tracks behind an Apache 2 Proxy on OpenBSD</a>
      
      
        <a class="basic-alignment right" href="/weblog/2006/08/07/free-isnt-free-enough/" title="Next Post: “free” isn't Free enough">“free” isn't Free enough &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/weblog/2012/05/10/static-bloggin/">Static Bloggin</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/28/i-am-not-a-climatologist-and-neither-are-most-of-these-people/">I am not a climatologist, and neither are most of these people</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/10/looking-for-summer-interns-in-the-software-technology-group-at-ibm-tj-watson-research-center/">Looking for Summer Interns in the Software Technology Group at IBM TJ Watson Research Center</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/a-review-of-2011-personal-development-goals/">A Review of 2011 Personal Development Goals</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/open-source-and-technology-predictions-for-2012/">Open Source and Technology Predictions for 2012</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/pridkett">@pridkett</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pridkett',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/weblog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("pridkett", 4, false);
    });
  </script>
  <script src="/weblog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/pridkett" class="twitter-follow-button" data-show-count="false">Follow @pridkett</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102672530623465237388?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Patrick Wagstrom -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
