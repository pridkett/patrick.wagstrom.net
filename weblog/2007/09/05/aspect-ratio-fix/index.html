
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fixing Letterboxed and Pillarboxed Transcoding in MythTV - My Delusional Dream</title>
  <meta name="author" content="Patrick Wagstrom">

  
  <meta name="description" content="Fixing Letterboxed and Pillarboxed Transcoding in MythTV Sep 5th, 2007 | var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://patrick.wagstrom.net/weblog/2007/09/05/aspect-ratio-fix">
  <link href="/weblog/favicon.png" rel="icon">
  <link href="/weblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/weblog/javascripts/modernizr-2.0.js"></script>
  <script src="/weblog/javascripts/ender.js"></script>
  <script src="/weblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/weblog/atom.xml" rel="alternate" title="My Delusional Dream" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/weblog/">My Delusional Dream</a></h1>
  
    <h2>Thoughts of a cautious technocrat</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/weblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:patrick.wagstrom.net/weblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/weblog/">Blog</a></li>
  <li><a href="/weblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Fixing Letterboxed and Pillarboxed Transcoding in MythTV</h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-09-05T10:08:00-04:00" pubdate data-updated="true">Sep 5<span>th</span>, 2007</time>
        
        
         | 

<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<script type="text/javascript" src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script>


        
      </p>
    
  </header>


<div class="entry-content"><p>The recent demise of <a href="http://labs.zap2it.com/">Zap2it labs</a> and the subsuquent creation of <a href="http://www.schedulesdirect.org/">Schedules Direct</a> was a pretty remarkable change in the MythTV community.  The community now has an almost official blessing from a TV Guide service to continue, a pretty big event for most open source projects.</p>

<p>However, due to the infrastructure of MythTV, it&#8217;s not easy to add a new TV listing service.  Rather, the change from Zap2it to Schedules Direct required all users to upgrade their copies of MythTV to the newest version of the stable branch.  Unfortunately, this version still has issues with transcoding high definition signals.  The major issue is that mythtranscode has no knowledge of the program aspect ratio.  It ends up storing pixels that aren&#8217;t needed, such as what happens when a 16:9 signal is sent in a 4:3 signal (letterboxed) or when a 4:3 signal is sent in a 16:9 signal (pillarboxed, much more common). In an ideal world, MythTV would know how to cope with these automatically when transcoding and just magically cut off the offending portions.</p>

  <figure class='center'>
        <img src="/weblog/media/2007/09/mythPillarBoxed.png">
        <figcaption>Pillarboxing on an episode of _The Simpsons_ recorded from a high definition source </figcaption>
    </figure>




  <figure class='center'>
        <img src="/weblog/media/2007/09/mythLetterBoxed.png">
        <figcaption>Letterboxing of a Frontline episode recorded with a standard definition source </figcaption>
    </figure>


<p>While the result is still acceptable, it&#8217;s not perfect and may force you to switch aspect ratios to watch the video. About a year ago, I wrote a patch for MythTV that transcoders to specify a target aspect ratio. This was against MythTV 0.20, and because the newer versions didn&#8217;t provide that many desirable features, I never updated the patch or my installation of MythTV. Facing the impending loss of guide data just days before that start of the NFL season, and only weeks before the start of the new TV season, I updated the patch for MythTV 0.20.2. You can find the <a href="http://svn.mythtv.org/trac/ticket/2581">transcoding aspect ratio patch in the MythTV Trac system</a>.</p>

<p>The patch still is far from perfect, and you&#8217;ll need some cron hackery to get it to work right. The main reason is because although MythTV allows you to create non-standard transcoder names in the frontend, it won&#8217;t let you use them for anything but the default transcoder. To get around this, you&#8217;ll need to look into your MythTV database and get the transcoder id numbers. For my system, I created a set of transcoders for 1080i, 720p, and 480i content that give me the option
of whether or not to resize on the transcode and the quality. Run the following command on your database to get a listing of the transcoders:</p>

<pre><code>mysql&gt; select * from recordingprofiles;
+----+-------------------+-------------------------+-------------------------+--------------+
| id | name              | videocodec              | audiocodec              | profilegroup |
+----+-------------------+-------------------------+-------------------------+--------------+
                                          :: snip ::
| 27 | 1080i No Resize   | MPEG-4                  | MP3                     |            6 |
| 28 | 1080i Resize      | MPEG-4                  | MP3                     |            6 |
| 29 | 720p No Resize    | MPEG-4                  | MP3                     |            6 |
| 30 | 480i No Resize    | MPEG-4                  | MP3                     |            6 |
| 31 | 720p Resize       | MPEG-4                  | MP3                     |            6 |
| 32 | 720p Resize Med   | MPEG-4                  | MP3                     |            6 |
| 33 | 1080i Resize Med  | MPEG-4                  | MP3                     |            6 |
                                          :: snip ::
| 46 | 1080i SDTV Resize | MPEG-4                  | MP3                     |            6 |
| 47 | 720p SDTV Resize  | MPEG-4                  | MP3                     |            6 |
+----+-------------------+-------------------------+-------------------------+--------------+
47 rows in set (0.01 sec)
</code></pre>

<p>Transcoders 27, 28, 29, 31, 32, and 33 all leave the aspect ratio unchanged.  Transcoder 30 is a transcoder that resizes 480i letterboxed content.  Transcoders 46 and 47 remove pillarboxes from SDTV signals transmitted over HD.  You&#8217;ll also notice that I have different transcoders for 1080i and 720p.  You don&#8217;t need to do this, but I have chosen to do this to avoid deinterlacing 720p signals &#8211; saving a bit of time and power.</p>

<p>The final step is to tell MythTV to periodically update the transcoders settings. I use a simple script called from cron about every 15 minutes:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>    <span class="c">#!/bin/sh</span>
</span><span class='line'>    <span class="nv">MYTHPASSWORD</span><span class="o">=</span><span class="s2">&quot;-pYOURMYTHPASSWORD&quot;</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;update recorded set transcoder=28 where chanid=3215 or chanid=3220 or chanid=3212 or chanid=3211;&quot;</span> | nice -n 10 mysql -u mythtv <span class="nv">$MYTHPASSWORD</span> mythconverg
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;update recorded set transcoder=31 where chanid=3213 or chanid=3210 or chanid=3214;&quot;</span> | nice -n 10 mysql -u mythtv <span class="nv">$MYTHPASSWORD</span> mythconverg
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;update recorded set transcoder=47 where (chanid=3213 or chanid=3210) and (title=&#39;The Simpsons&#39; or title=&#39;Family Guy&#39; or title=&#39;American Dad&#39; or title=&#39;King of the Hill&#39;);&quot;</span> | nice -n 10 mysql -u mythtv <span class="nv">$MYTHPASSWORD</span> mythconverg
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;update recorded set transcoder=47 where (chanid=3214) and (title=&#39;Mad Max&#39; or title=&#39;Bubble Boy&#39; or title=&#39;Hotel Rwanda&#39;);&quot;</span> | nice -n 10 mysql -u mythtv <span class="nv">$MYTHPASSWORD</span> mythconverg
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;update recorded set transcoder=47 where (chanid=3210) and (title=&#39;The Ten Commandments&#39;);&quot;</span> | nice -n 10 mysql -u mythtv <span class="nv">$MYTHPASSWORD</span> mythconverg
</span></code></pre></td></tr></table></div></figure>


<p>This script forces the 1080i channels to use transcoder 28 and the 720p channels to use transcoder 31.  The last three lines are for pillarboxed programs that recorded off 720p that must be unpillarboxed. With this in the background, when transcoding I select the default transcoder and the output will be properly cropped.</p>

<p>As an added bonus, this patch also fixes issues with mythtranscode not understanding that 1080i signals are encoded as 1088 (due to MPEG files needing to be a multiple of 16 lines high) and encoding a nasty gray bar at the bottom of your 1080i transcoded vidoes. It also cuts off the top eight pixels of most recordings because Comcast normally sends junk on those lines that looks like static.</p>

<p><strong>Update:</strong> I didn&#8217;t mention on my original post that if you schedule a recording via MythWeb, there is an option to set the transcoder.  In this screenshot (click for full size), you can see where I specified the transcoder &#8220;720p SDT Resize&#8221; for use on &#8220;The Simpsons&#8221;.</p>

  <figure class='center'>
        <img src="/weblog/media/2007/09/mythtvTranscoderSet.png">
        <figcaption>Setting the transcoder in Mythweb </figcaption>
    </figure>



</div>


<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>




  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Patrick Wagstrom</span></span>

      








  


<time datetime="2007-09-05T10:08:00-04:00" pubdate data-updated="true">Sep 5<span>th</span>, 2007</time>
      

<span class="categories">
  
    <a class='category' href='/weblog/blog/categories/mythtv/'>mythtv</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://patrick.wagstrom.net/weblog/2007/09/05/aspect-ratio-fix/" data-via="pridkett" data-counturl="http://patrick.wagstrom.net/weblog/2007/09/05/aspect-ratio-fix/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/weblog/2007/07/27/yearlydiff2007/" title="Previous Post: Yearly Home Page Update">&laquo; Yearly Home Page Update</a>
      
      
        <a class="basic-alignment right" href="/weblog/2007/09/25/what-you-should-love-about-gutsy/" title="Next Post: What you should love about Ubuntu Gutsy">What you should love about Ubuntu Gutsy &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/weblog/2012/05/10/static-bloggin/">Static Bloggin</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/28/i-am-not-a-climatologist-and-neither-are-most-of-these-people/">I am not a climatologist, and neither are most of these people</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/10/looking-for-summer-interns-in-the-software-technology-group-at-ibm-tj-watson-research-center/">Looking for Summer Interns in the Software Technology Group at IBM TJ Watson Research Center</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/a-review-of-2011-personal-development-goals/">A Review of 2011 Personal Development Goals</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/open-source-and-technology-predictions-for-2012/">Open Source and Technology Predictions for 2012</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/pridkett">@pridkett</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pridkett',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/weblog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("pridkett", 4, false);
    });
  </script>
  <script src="/weblog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/pridkett" class="twitter-follow-button" data-show-count="false">Follow @pridkett</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102672530623465237388?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Patrick Wagstrom -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
