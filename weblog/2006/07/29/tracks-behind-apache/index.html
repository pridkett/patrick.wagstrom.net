
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tracks behind an Apache 2 Proxy on OpenBSD - My Delusional Dream</title>
  <meta name="author" content="Patrick Wagstrom">

  
  <meta name="description" content="Tracks Behind an Apache 2 Proxy on OpenBSD Jul 29th, 2006 | var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://patrick.wagstrom.net/weblog/2006/07/29/tracks-behind-apache">
  <link href="/weblog/favicon.png" rel="icon">
  <link href="/weblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/weblog/javascripts/modernizr-2.0.js"></script>
  <script src="/weblog/javascripts/ender.js"></script>
  <script src="/weblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/weblog/atom.xml" rel="alternate" title="My Delusional Dream" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/weblog/">My Delusional Dream</a></h1>
  
    <h2>Thoughts of a cautious technocrat</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/weblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:patrick.wagstrom.net/weblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/weblog/">Blog</a></li>
  <li><a href="/weblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Tracks Behind an Apache 2 Proxy on OpenBSD</h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-29T00:46:00-04:00" pubdate data-updated="true">Jul 29<span>th</span>, 2006</time>
        
        
         | 

<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<script type="text/javascript" src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script>


        
      </p>
    
  </header>


<div class="entry-content"><p>Like most geeks, I suffer from a profound lack of an ability to get things done.  I&#8217;ve read a lot of the stuff on <a href="http://www.43folders.com/">43 folders</a> and even thought about trying a few, but never really got around to it.  Yes, I&#8217;m that bad at getting things done.  One of these days, I may actually buy <a href="http://www.amazon.com/gp/product/0142000280/">David Allen&#8217;s book <em>Getting Things Done</em></a>.  But for right now, I look at the fact that I&#8217;d have to pay shipping on it from Amazon and I say no.</p>

<p>I feel good to know that I&#8217;m not alone. <a href="http://kenneths.org/flog/">Kenneth</a> also suffers from the same issues, at times it appears that Pridjano Enterprises is better at being a support group for slackers than it is at changing the world.  However, today, something different hit my radar.  <a href="http://tieguy.org/blog/">Luis Villa</a>, GNOME bugmaster extraordinaire, and overall really helpful guy made a <a href="http://tieguy.org/blog/2006/07/27/from-trac-to-tracks-for-gtd/">weblog entry about switching form trac to tracks for GTD</a>.  I was intrigued.  I had never thought about using Trac to manage my GTD in the first place, I guess it could be used, but it wasn&#8217;t designed for such and application from the ground up, thus it had some rougher edges when used for GTD.  After some poking around, I saw that <a href="http://www.rousette.org.uk/projects/">Tracks</a> looked like a pretty cool webapp.  One problem, it runs on Ruby on Rails. Ouch.  I had managed to stay away from Ruby on rails for quite a long time, it was time to give in.</p>

<p>First of all, <a href="http://www.ruby-lang.org/">Ruby</a> is a lot like <a href="http://www.python.org/">Python</a> and <a href="http://www.perl.org/">Perl</a>.  From what I can tell, it&#8217;s about halfway between the two languages.  I don&#8217;t see any clear advantage to using it, other than it doesn&#8217;t enforce the spacing requirements of Python, which is the major complaint I hear from people who have never used Python. Rails is a model, view, container sorta setup for developing web applications. It&#8217;s supposed to be pretty cool and pretty slick to develop apps with.  If you haven&#8217;t seen the <a href="http://www.rubyonrails.org/screencasts">15 minute weblog on Rails movie</a>, I highly recommend it.  Pretty slick.  However, like many of the other frameworks such as <a href="http://www.cherrypy.org/">CherryPy</a>, <a href="http://www.turbogears.org/">TurboGears</a>, and <a href="http://www.djangoproject.com/">Django</a>, the framework requires a specialized and dedicated web server.  Well, not exactly, but most everyone runs it like that.  It was either that, or run it using <a href="http://www.fastcgi.com/">FastCGI</a>, which I&#8217;m not about to touch.</p>

<p>So, now the issue is, if it requires it&#8217;s own personal web server, it probably doesn&#8217;t support encryption, right?  If I&#8217;m storing my task list on there and accessing it from a <a href="http://www.cmu.edu/computing/wireless/">frequently sniffed unencrypted wireless network</a>, I certainly wantÂ  SSL/TLS encryption, which the <a href="http://www.lighttpd.net/">Lighttpd</a> that ships with <a href="http://www.rubyonrails.com/">Ruby on Rails</a> probably doesn&#8217;t support (note: I haven&#8217;t 100% checked the previous statement for it&#8217;s truthiness). I knew that I could easily do some proxying, after all, I currently have my installation of <a href="http://www.mythtv.org/wiki/index.php/MythWeb">MythWeb</a> running behind such a proxy with little difficulty.  So this shouldn&#8217;t be hard.</p>

<p>The first step was installing <a href="http://www.ruby-lang.org/">Ruby</a> and <a href="http://rubyforge.org/projects/rubygems/">Ruby-Gems</a> onto my <a href="http://www.openbsd.org/">OpenBSD</a> server.  Ruby is already in ports so it was a simple matter of running cd /usr/ports/lang/ruby &amp;&amp; FLAVOR=no_x11 sudo make install and waiting a little bit as Ruby was compiled for my system.  The next step was to build the <a href="http://www.rubygems.org/">Ruby Gems</a> package. Unfortunately, this package does not ship with a port in OpenBSD, but you can find one online at <a href="http://archives.neohapsis.com/archives/openbsd/2006-01/0710.html">this link</a>, download it and untar it in /usr/ports/devel then run cd /usr/ports/devel/ruby-gems &amp;&amp; sudo make install to build the Ruby Gems package.</p>

<p>At this point you can install all sorts of Ruby packages with little difficulty, but we&#8217;re going to need to stay in the ports tree for a little bit longer.  If do not yet have sqlite3 installed, do that now.  While it&#8217;s possible to run Rails applications with any database, I chose SQLite because I don&#8217;t feel like setting up a full blown MySQL or PostgreSQL database on my web server.  So, run the command cd /usr/ports/databases/sqlite3 &amp;&amp; sudo make install, to build the libraries necessary for SQLite3, the preferred database for this little tutorial.  Finally, you&#8217;ll need to use the Ruby Gems package to install the SQLite3 bindings for Ruby, and <a href="http://rake.rubyforge.org/">Rake</a>, which is Ruby&#8217;s version of the venerable <a href="http://www.gnu.org/software/make/">Make</a> software.  Installing software packages with Ruby Gems is pretty quick.  Just run these two commands to install both Rake and the SQLite3-ruby bindings.  If you&#8217;re presented with multiple choices, just take the newest version. sudo gem install sqlite3-ruby, sudo gem install rake.  Finally, at this point you should all of the prerequisites installed for running Tracks on your system.</p>

<p>The next step is to download Tracks and unpack it.  I recommend creating a generic symlink to make the path something like ~/tracks instead of ~/tracks-1.041. It&#8217;s much cleaner and easier to understand.  I&#8217;ll also assume that you&#8217;ve followed the <a href="http://www.rousette.org.uk/projects/manual/index">default installation instructions</a> and been able to get it running at http://0.0.0.0:3000/, as specified in the documentation.  Now, we&#8217;ve gotta have some fun and change a few things around.  The reason we need to move stuff around is because Rails expects to be at the root of the directory tree, and not somewhere else, we&#8217;re going to shoehorn it.  Start by adding the following line to ~/tracks/config/environment.rb.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>    <span class="no">ActionController</span><span class="o">::</span><span class="no">AbstractRequest</span><span class="o">.</span><span class="n">relative_url_root</span> <span class="o">=</span> <span class="s2">&quot;/tracks&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This tells Rails that it&#8217;s not at the root of the directory hierarchy anymore. Now, we need to correct a small problem with the static content.  There probably is a more appropriate way to do this, but I&#8217;ve found my method works quite nicely.  Just run these commands:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>    <span class="nb">cd</span> ~/tracks/public
</span><span class='line'>    mkdir tracks
</span><span class='line'>    <span class="nb">cd </span>tracks
</span><span class='line'>    <span class="k">for </span>x in images javascripts stylesheets; <span class="k">do </span>ln -s ../<span class="nv">$x</span> <span class="nv">$x</span>; <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>These commands fix some of the static content issues.  If you restart your Tracks installation, you should now need to access it using the /tracks url (i.e. http://0.0.0.0:3000/tracks).  The final step is to let Apache know it&#8217;s supposed to forward requests through to your Tracks installation.  Within OpenBSD, I have a file called /usr/local/apache2/conf/extra/httpd-ssl.conf, which was previously configured as my secure server.  Now, just add the following line to that file:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'>    <span class="nb">Include</span> conf/extra/tracks.conf
</span></code></pre></td></tr></table></div></figure>


<p>And now create the file /usr/local/apache2/conf/extra/tracks.conf, and put the following content in it:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'>    <span class="nb">RewriteEngine</span> <span class="k">on</span>
</span><span class='line'>    <span class="nb">RewriteRule</span> ^/tracks$ https://secure.wagstrom.net/tracks/ [R,L]
</span><span class='line'>
</span><span class='line'>    <span class="nb">ProxyPass</span> <span class="sx">/tracks/</span> http://127.0.0.1:3000/tracks/
</span><span class='line'>    <span class="nb">ProxyPassReverse</span> <span class="sx">/tracks/</span> http://127.0.0.1:3000/tracks/
</span><span class='line'>    <span class="nb">ProxyPreserveHost</span> <span class="k">on</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first two lines help with some URL fixing in case someone forgets the trailing / at the end of the url.  The next lines tell it to proxy all requests for /tracks/ through to the special Rails instance of Lighttpd that&#8217;s running.  After restarting your apache instance and starting your Tracks server, you should now be able to access your installation of Tracks through your secure server.</p>

<p>I should make it perfectly clear, I know basically nothing about Rails or Ruby, and frankly, there are some portions of the Apache proxy stuff I&#8217;m not 100% on either.  But, I can say, this works quite well for me and provides easy access to my Tracks installation on my secure server.  I&#8217;m not sure if there is an easier way to change where the file locations are, or if there is a way to avoid making the symlinks in ~/tracks/public, if there is, I&#8217;d love to hear it.  My major comment is that this whole process was much more difficult to figure out than it should have been.  You&#8217;d think that with all the blabbering from the <a href="http://store.muledesign.com/shirts/koolaid.php">Web 2.0 kids</a> this process would easier than that, with better documentation.  It took me quite some time of scouring the web to figure this out, here&#8217;s hoping that I get some Blogosphere loving and this post can save you time in the future.</p>
</div>


<script>
var idcomments_acct = 'de6c2d3e38f6fdb9bf16fa9f1904f35d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>




  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Patrick Wagstrom</span></span>

      








  


<time datetime="2006-07-29T00:46:00-04:00" pubdate data-updated="true">Jul 29<span>th</span>, 2006</time>
      

<span class="categories">
  
    <a class='category' href='/weblog/blog/categories/web/'>web</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://patrick.wagstrom.net/weblog/2006/07/29/tracks-behind-apache/" data-via="pridkett" data-counturl="http://patrick.wagstrom.net/weblog/2006/07/29/tracks-behind-apache/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/weblog/2006/07/27/yearlydiff2006/" title="Previous Post: Yearly Home Page Update">&laquo; Yearly Home Page Update</a>
      
      
        <a class="basic-alignment right" href="/weblog/2006/07/30/tracks-behind-apache-static/" title="Next Post: Tracks Behind Apache With Non-Proxied Static Content">Tracks Behind Apache With Non-Proxied Static Content &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/weblog/2012/05/10/static-bloggin/">Static Bloggin</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/28/i-am-not-a-climatologist-and-neither-are-most-of-these-people/">I am not a climatologist, and neither are most of these people</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/10/looking-for-summer-interns-in-the-software-technology-group-at-ibm-tj-watson-research-center/">Looking for Summer Interns in the Software Technology Group at IBM TJ Watson Research Center</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/a-review-of-2011-personal-development-goals/">A Review of 2011 Personal Development Goals</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/open-source-and-technology-predictions-for-2012/">Open Source and Technology Predictions for 2012</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/pridkett">@pridkett</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pridkett',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/weblog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("pridkett", 4, false);
    });
  </script>
  <script src="/weblog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/pridkett" class="twitter-follow-button" data-show-count="false">Follow @pridkett</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102672530623465237388?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Patrick Wagstrom -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
