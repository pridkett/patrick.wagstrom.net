
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Delusional Dream</title>
  <meta name="author" content="Patrick Wagstrom">

  
  <meta name="description" content="Here are the steps one can take to get free wireless in Linux. As long as the
network isn&#8217;t encrypted this should work. Install and configure &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://patrick.wagstrom.net/weblog/blog/page/20">
  <link href="/weblog/favicon.png" rel="icon">
  <link href="/weblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/weblog/javascripts/modernizr-2.0.js"></script>
  <script src="/weblog/javascripts/ender.js"></script>
  <script src="/weblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/weblog/atom.xml" rel="alternate" title="My Delusional Dream" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/weblog/">My Delusional Dream</a></h1>
  
    <h2>Thoughts of a cautious technocrat</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/weblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:patrick.wagstrom.net/weblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/weblog/">Blog</a></li>
  <li><a href="/weblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2005/02/17/freewireless/">Steps to Free Wireless in Linux</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-02-17T21:40:00-05:00" pubdate data-updated="true">Feb 17<span>th</span>, 2005</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here are the steps one can take to get free wireless in Linux.  As long as the
network isn&#8217;t encrypted this should work.</p>

<ol>
<li>Install and configure <a href="http://www.kismetwireless.net/">Kismet</a>.</li>
<li>Sniff traffic to find open access points.</li>
<li>If an open access point is not available, then sniff for MAC addresses.

<ol>
<li>Modify your driver to force your MAC address to that of an existing client</li>
<li>Make sure to write down your old address.</li>
<li>Install the modified driver.</li>
</ol>
</li>
<li>Enjoy your newfound wireless access.</li>
</ol>


<p>Note, I&#8217;m doing the former, not the latter (i.e. I&#8217;m on an open access point).
If you get really ambitious, it might be possible to hack a WRT54G to do this
for you.  That would be fun.</p>

<p><strong>Update:</strong> As a quick Googling found, there is no reason to recompile
your driver as long as it supports setting the hardware address.  To
do this, before you bring up the device run <code>ifconfig eth0 hw ether
01:02:03:04:05:06</code>.  More information is
<a href="http://www.talvi.net/notes/mac-spoofing.html">available here</a>.  I
have not tried this, nor do I advocate this, but it&#8217;s just something
cool I think you can do.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2005/02/13/moreonmythtorrent/">More on MythTorrent</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-02-13T21:17:00-05:00" pubdate data-updated="true">Feb 13<span>th</span>, 2005</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m surpised by how many people have emailed me about
<a href="/weblog/mythTorrent">MythTorrent</a> over the past few days.  I didn&#8217;t expect
that people actually noticed when I posted stuff here.  Anyway, here
is a bit more of an explanation of how it works.</p>

<p>First of all, it is an independent python script that connects to your
master database using the MySQLdb database driver.  From there it
queries the recorded table and gets a list of all of the most recently
recorded shows.  It then goes and creates torrents for any of the
files that it hasn&#8217;t already done so and finally registers the
torrents with my tracker (just the default BitTorrent tracker).</p>

<p>Now the seeding is the difficult part.  It seeds all of the shows by
firing up individual instances of BitTorrent to seed them.  There has
got to be a better way to do this.  Maybe if I actually read the docs,
this might be easier, but for now it works.  However, I&#8217;ve only got
about 30GB for my Myth box right now (although I&#8217;ll get some more soon
because Staples is gonna have hard drives on sale next week, thank you
<a href="http://www.fatwallet.com/">FatWallet</a>), so this is still feasible,
firing up about 30 instances of BitTorrent.</p>

<p>Where I&#8217;m going to run into problems is what happens when I&#8217;ve got
more shows.  If I pick up a 200GB hard disk and each show is 500 megs,
that 400 BitTorrent processes.  Clearly that isn&#8217;t going to work, from
a memory perspective or a bandwidth perspective.  Oh yeah, I think
BitTorrent can only have 200 ports or so in use.  So I&#8217;m gonna need to
look at this some more.</p>

<p>What I&#8217;m going to need to do is figure out a way to have a client seed
multiple files, or merely act as a virtual seed for multiple files.  I
don&#8217;t intend on allowing everyone in the world to download shows from
me, in fact, this is more of an academic exercise than anything else.
Just to show it can be done.  However, I want this to work well and
not be a crappy hack.</p>

<p>Right now the RSS feed isn&#8217;t always updated properly.  At least not on
this server, and the URLs for the torrents are all mangled because I
don&#8217;t want other people hitting the torrents (I don&#8217;t want to land in
copyright violation land).  They get updated periodically from my
MythTV Backend (700MHz athlon) to my web server (200MHz K6).
Although, there is no reason why the K6 couldn&#8217;t run MythTorrent right
now.</p>

<p>Now the $3.75 question, &#8220;when will I release this?&#8221;  The answer is
sometime.  That&#8217;s about the best I can say.  I&#8217;m busy this week with
school and then my presentation at SunBelt (come see me babble about
Open Source weblogs and infering social structure on Friday
afternoon).  I&#8217;ve got a wonderful red-eye back to Pittsburgh on Sunday
night, so I might work on it some there.</p>

<p>That is all for now.  Time to dig up some papers to read for my
research.  I&#8217;m still really burnt out from qualifiers and haven&#8217;t been
focused at all.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2005/02/10/svgcitlogo/">CIT Logo in SVG</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-02-10T22:15:00-05:00" pubdate data-updated="true">Feb 10<span>th</span>, 2005</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m sorta on a mission.  I really need some graphics to brand my
presentations and stuff, but most are of hideous resolution or in
non-editable format.  With that being said, my new hack today is the
<a href="http://www.cit.cmu.edu/">College of Engineering</a> logo for
<a href="http://www.cmu.edu/">Carnegie Mellon</a>.</p>

<p>For some reason, my SVG viewer doesn&#8217;t like always displaying these,
but I assure that you can mangle them all you&#8217;d like in your favorite
SVG editor.  If you&#8217;d like to download them, here is the
<a href="/weblog/media/2005/02/CITblack.svg">black logo</a> and here is the
<a href="/weblog/media/2005/02/CITblue.svg">blue logo</a>.</p>

<p><a href="/weblog/weblog/media/2005/02/CITblack.svg"><object
data="/weblog/media/2005/02/CITblack.svg"
type="image/svg+xml"></object></a></p>

<p><a href="/weblog/weblog/media/2005/02/CITblue.svg"><object
data="/weblog/media/2005/02/CITblue.svg"
type="image/svg+xml"></object></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2005/02/09/svgcasoslogo/">CASOS Logo in SVG</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-02-09T18:15:00-05:00" pubdate data-updated="true">Feb 9<span>th</span>, 2005</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here is the old logo for <a href="http://www.casos.cs.cmu.edu/">CASOS</a>.  It
looks okay, but it&#8217;s only in raster format and furthermore has lots of annoying
artifacts from being JPEG compressed a few too many times.</p>

<p><img src="/weblog/media/2005/02/casosLogo.png"></p>

<p>I got tired of this, so I created a nice new vector image.  This was done using
<a href="http://www.inkscape.org/">Inkscape</a> and <a href="http://autotrace.sf.net/">Autotrace</a> (for the words).  Now that it&#8217;s SVG, not only is it smaller
once compressed, but it also is infinitely scalable and convertable.  If you
can see the picture, <a href="/weblog/media/2005/02/casosLogo.svg">click here</a> to download the SVG file.  You might need the SVG Plugin from Adobe.</p>

<p>I was really impressed with how easy this was.  There still are a few tweaks
that should be done to the letters, which will reduce the file size even more,
but in general it&#8217;s pretty nice for my first effort at creating a vector
graphic.  Inkscape and Autotrace made it terribly easy too.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2005/02/07/thebean/">The Bean</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-02-07T12:55:00-05:00" pubdate data-updated="true">Feb 7<span>th</span>, 2005</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>As most of my readers know, before migrating to Pittsburgh, I lived in Chicago for
six years.  It&#8217;s a great city to live in and their parks are wonderful.  While in
Chicago, I paid my share of city taxes.  I&#8217;m sure some of my money went to help
build Millenium Park, which was supposed to be open in 2000, but didn&#8217;t open up
until 2004.  I got a chance to see it in November when I was in town for CSCW.</p>

<p>Well, it turns out, it&#8217;s illegal for me to photograph &#8220;The Bean&#8221;, even
though my tax dollars paid for it and it&#8217;s in a public space.  You can
read all about it how
<a href="http://newurbanist.blogspot.com/2005/01/copyrighting-of-public-space.html">The Bean is copyrighted Public Space</a>.
I don&#8217;t think that Anish Kapoor, the artist behind The Bean,
understands copyright law. Here&#8217;s some of my pictures of the bean.  If you&#8217;d like
the 3.2 megapixel ones let me know.</p>

<p><img src="/weblog/media/2005/02/theBean1.jpg">
<img src="/weblog/media/2005/02/theBean2.jpg">
<img src="/weblog/media/2005/02/theBean3.jpg">
<img src="/weblog/media/2005/02/theBean4.jpg">
<img src="/weblog/media/2005/02/theBean5.jpg">
<img src="/weblog/media/2005/02/theBean6.jpg"></p>

<p>All of these photos are taken by me and owned by me.  I hereby release
them under a
<a href="http://creativecommons.org/licenses/by-sa/2.0/">Creative Commons By-SA license</a>.
Yes, you can feel free to profit off these just to piss Anish Kapoor
off.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2005/01/27/publichealth/">Scary Public Health Stuff</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-01-27T09:54:00-05:00" pubdate data-updated="true">Jan 27<span>th</span>, 2005</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>My Uber-Intelligent office and stat/public health loving officemate
Sarah sent me a wonderful
<a href="http://www.dhs.ca.gov/ps/cdic/cdcb/pds/cpe/Documents/090904Handout.pdf">set of public health slides from California</a>.
Apparently, this briefing was used for the Governator to convince him
that California needed to stop &#8220;Dumb growth&#8221; and be more intelligent
about creating communities.  It touches on a lot of issues, such as
community design, exercise, and walking to school and has some good
graphs in it.  I&#8217;ve taken the liberty of using some ImageMagick
Ninja-Foo to convert the set of slides on obesity to trends to a nice
animated gif, which you can see below.  The moral is that apparently
all the hard bodies live in Colorado, while every place else in
America is populated by fatasses.  Yay for Mississippi.</p>

<p><img src="/weblog/media/2005/01/lookAtTheFatPeople.gif"></p>

<p>On a side note, if anyone knows how to get ImageMagick to generate a flash
image that would be nice.  Animated Gifs really are teh suck.  I can&#8217;t wait
for <a href="http://www.vlad1.com/~vladimir/projects/apng/">APNG</a> to get
into the main branch of FireFox and ImageMagick.  In the mean time, here is
the command line I used to make these.  A little quality time with the GIMP was
spent afterwards to ensure that maps were all about the same size.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>    a2ps -a 39-45 -1 090904Handout.pdf -o - | <span class="se">\</span>
</span><span class='line'>      convert -resize 512x384 -size 512x384 -rotate 90 -delay 500 -dispose None - out.gif
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2004/12/14/bloglinessubscribers/">Figuring Out Bloglines Subscribers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-12-14T21:45:00-05:00" pubdate data-updated="true">Dec 14<span>th</span>, 2004</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a bit of a lazyweb request.  Does anyone know of a way so I can
see who the six people who subscribe to my feed on <a href="http://www.bloglines.com/">BlogLines</a>.
If it&#8217;s truly fostering a social atmosphere then you should be able to
see who is subscribed, ala <a href="http://del.icio.us/">del.icio.us</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2004/12/13/bandwidththief/">Stopping Bandwidth Thieves</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-12-13T18:32:00-05:00" pubdate data-updated="true">Dec 13<span>th</span>, 2004</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m progressing well on my war to reclaim bandwidth back from spammers
and other nefarious foul beasts who can barely be classified as human.
Today I had to take a step that I&#8217;d rather not do because it becomes a
real pain in the butt, but nonetheless, I needed to do it.</p>

<p>One of the wonderful things about the web is the ability to link to
any document anywhere on the web.  This is great because it means that
we don&#8217;t need to follow extended instructions on how to locate a
document on a server.  We should all be happy that
<a href="http://www.gigalaw.com/articles/2000-all/kubiszyn-2000-05b-all.html">deep-linking is protected</a>
and that we don&#8217;t need to sign asinine
<a href="http://www.google.com/search?q=%22link+agreement%22">link agreements</a>
to link to websites.  However, for people who run their site off a low
bandwidth link (my cable modem in my case), this can sometimes be a
bad thing.</p>

<p>The problem occurs when that linking turns into bandwidth thievery.
You know, when people post an image or a graphic and pretend like it&#8217;s
theirs but really just link to yours.  Yeah, it sucks.  This has
happened to me twice in the past month and cost me about 10MB of
bandwidth (which is about 4% of my total usage so far this month).
So, I pronounce Mod_Rewrite Vendetta upon thee!  Here&#8217;s how to do it:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} !^$
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} !^http://patrick.wagstrom.net/.*$ [NC]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} !^http://192.168.*$
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} !^http://.*\.bloglines.com/.*$ [NC]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} !^http://.*\.google.com/.*$ [NC]
</span><span class='line'>    <span class="nb">RewriteRule</span> ^/resources/images/.*\.(gif|png|jpg)$ <span class="sx">/resources/images/bandwidthThief.png</span> [L]
</span></code></pre></td></tr></table></div></figure>


<p>So what&#8217;s going on here?  Well, we&#8217;re checking the <code>HTTP_REFERER</code> header
to see where the person is coming from.  If it is not a direct link
(indicated by an empty referer), from somewhere on my site, from
within my local subnet, from <a href="http://www.bloglines.com/">Bloglines</a>,
or from <a href="http://www.google.com/webhp?complete=1">Google</a>, then it
matches this rule.  In those cases, it looks and sees if the request
is to an image in my image directory.  If is is, then it automagically
changes it so it shows the much smaller (3400 byte) bandwidth thief
graphic.</p>

<p>What&#8217;s the interesting thing is that when you deep link to anothers
image, or include it in a bulletin board posting, as was done here,
you&#8217;re completely at the mercy of the person who hosts the image.  I
could have easily changed that picture to something lewd, profane, or
just generally tasteless and made it look like it came from that user.
Or worse, I could hack up a graphic to make it look like the text in
the board so the person would appear to be saying naughty stuff.
Anyway, I&#8217;m not sure if I&#8217;ll leave this one on or not.  I&#8217;ve had mixed
success in the past with this sort of rule because of the number of
times it triggers when I don&#8217;t want it to.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2004/12/10/banninglinkspammers2/">Really Banning Link Spammers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-12-10T11:35:00-05:00" pubdate data-updated="true">Dec 10<span>th</span>, 2004</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Realizing that I shouldn&#8217;t be content with just sending out
<a href="/weblog/weblog/meta/banningLinkSpammers.txt">403 codes to link spammers</a>, I
decided to get a little more devious.  I&#8217;ve now hooked up a CGI to
handle the 403 errors.  What&#8217;s even better, it hooks into pfctl on
<a href="http://www.openbsd.org/">OpenBSD</a> to dynamically ban the people as
they hit the site.  You can&#8217;t ask for much better than that.  Well, we
could be talking about integrating some layer 7 stuff here, but I
digress.</p>

<p>So, first there is some work that needs to be done in the httpd.conf
file that configures the server.  This is shown below:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'>    <span class="nb">ErrorDocument</span> <span class="m">403</span> <span class="sx">/cgi-bin/403.cgi</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># provide a method to test the blocker</span>
</span><span class='line'>    <span class="nb">RewriteCond</span> %{QUERY_STRING} ^deny=true$
</span><span class='line'>    <span class="nb">RewriteRule</span> !^/cgi-bin/403.cgi$ - [F]
</span><span class='line'>
</span><span class='line'>    <span class="c"># all the referrers we don&#39;t like</span>
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^http://(www\.)?.*(-.*)+\.info/.*$ [NC,OR]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^http://(www\.)?adminshop.com/.*$ [NC,OR]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^http://(www\.)?webdevboard.com/.*$ [NC,OR]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^http://(www\.)?devaddict.com/.*$ [NC,OR]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^http://(www\.)?whiteguysgroup.com/.*$ [NC,OR]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^http://(www\.)?guestbookz.com/.*$ [NC,OR]
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^http://(www\.)?xopy.com/.*$ [NC]
</span><span class='line'>    <span class="nb">RewriteRule</span> !^/cgi-bin/.*$ - [F]
</span><span class='line'>
</span><span class='line'>    <span class="c"># Ban comment spammers</span>
</span><span class='line'>    <span class="c"># This stops people who try to write scripts to comment spam me</span>
</span><span class='line'>    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^-?$
</span><span class='line'>    <span class="nb">RewriteRule</span> ^/mt/mt-comments.cgi$ - [F,L]
</span></code></pre></td></tr></table></div></figure>


<p>In a nutshell, I&#8217;ve done a cople of things.  First, I&#8217;ve sent all 403
error statements through the CGI.  Next, I&#8217;ve modified it so I can
test the system by allowing me to append &#8220;?deny=yes&#8221; to any URL and
get the 403 error page (and thus blocked).  After that, we&#8217;ve got a
section blocking all the referrers that I don&#8217;t like.  Finally, I&#8217;ve
decided to stop people who are still trying to hit my MovableType
system that&#8217;s been dead for well over a year now.</p>

<p>The next step is to modify your <code>/etc/pf.conf</code> file to allow for the
blocking.  The new rules are shown below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>table &lt;http_always_allowed> { 192.168.1.0/24 }
</span><span class='line'>    table &lt;http_banned> persist
</span><span class='line'>    web_ports = "{ 80 }"
</span><span class='line'>    
</span><span class='line'>    pass in quick proto tcp from &lt;http_always_allowed> to any port $web_ports keep state
</span><span class='line'>    block in quick proto tcp from &lt;http_banned> to any port $web_ports</span></code></pre></td></tr></table></div></figure>


<p>This creates two tables.  One contains a list of all hosts that are
allowed no matter what to hit the web server.  Put your testing host
in here or you&#8217;ll get blocked.  The second tells the system to create
a table called http_banned that contains banned ip addresses.  Next,
we set up web_ports as a listing of ports the web server runs on.
Finally, we create a rule to allow the people in the
http_always_allowed table to always connect and the final rule blocks
all connects from http_banned hosts.</p>

<p>If you&#8217;ve gotten this far, you&#8217;re doing well.  Now we need to create
the CGI to make sure it can ban people.  Here is my version of
<code>/cgi-bin/403.cgi</code> that I use on my site:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/local/bin/python</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">datetime</span>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>  <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;sudo pfctl -t http_banned -T add </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;REMOTE_ADDR&quot;</span><span class="p">))</span>
</span><span class='line'>  <span class="n">body</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'><span class="k">except</span><span class="p">:</span>
</span><span class='line'>  <span class="n">body</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;&quot;&quot;Content-Type: text/html</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;body&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;p&gt;You suck&lt;/p&gt;&lt;pre&gt;</span><span class="si">%s</span><span class="s">&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">body</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>  <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/tmp/ipaddr&quot;</span><span class="p">,</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Host=[</span><span class="si">%s</span><span class="s">] URI=[</span><span class="si">%s</span><span class="s">] Agent=[</span><span class="si">%s</span><span class="s">] Time=[</span><span class="si">%s</span><span class="s">]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;REMOTE_ADDR&quot;</span><span class="p">),</span>
</span><span class='line'>                                                         <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;REDIRECT_URL&quot;</span><span class="p">),</span>
</span><span class='line'>                                                         <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;HTTP_USER_AGENT&quot;</span><span class="p">),</span>
</span><span class='line'>                                                         <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'><span class="k">except</span><span class="p">:</span>
</span><span class='line'>    <span class="k">pass</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&#8217;ll notice one little problem, this guy calls sudo in order to
block the port.  That means we need to allow the web user to call
pfctl.  This is probably not a good idea for a multi user system.  A
better idea is to write a wrapper program which ONLY adds entries to
the list of banned clients.  If you&#8217;ve gotten this far, you can
probably figure out how to do that on your own.</p>

<p>The very last step is to allow the web server to call sudo for pfctl.
Here are the lines that I have in my <code>/etc/sudoers</code> to allow this to
happen.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cmnd_Alias WEB = /sbin/pfctl
</span><span class='line'>    www     ALL=(ALL) NOPASSWD: WEB</span></code></pre></td></tr></table></div></figure>


<p>Putting all of these things together should get your system up and
going.  Now you can come back in a little while and look and see who
has been banned from your server.  It&#8217;s oh so delicious!  Have fun and
enjoy banning bastards.  This method could be easily extended to ban
bots that hit unauthorized pages or whatever you want.  Just remember,
autobanning like this is a sure fire way to lock yourself out of your
system.  Don&#8217;t blame me for your problems.</p>

<pre>
    [patrick@scissors] <b>sudo pfctl -t http_banned -T show</b>
       80.58.11.107
       196.20.31.121
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2004/12/08/morelinkspammerfun/">More on Banning Link Spammers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2004-12-08T09:57:00-05:00" pubdate data-updated="true">Dec 8<span>th</span>, 2004</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Looking through my weblogs I saw that I also was getting a lot of hits
from
<a href="http://visualintensity.com/adminshop-com">http://www.xopy.com/friendslinks.php</a>,
at first I thought it was a nifty site like
<a href="http://del.icio.us/">del.icio.us</a> that allowed you to see friends
links.  It turns out that they&#8217;re part of a group called
<a href="http://visualintensity.com/adminshop-com/">AdminShop</a>, and they&#8217;re
basically doing link spamming.  So I needed to add them to my block
list.</p>

<p>Now this seems to cut down on most of my link spamming.  However, it
still isn&#8217;t ideal.  I guess in an ideal world I&#8217;d set up small little
CGI that I&#8217;d force them to.  Once they hit they CGI they&#8217;d get their
IP address logged and immediately sent to pf for banning of the
client.  I suppose I could whip something like that up pretty easily,
but I don&#8217;t have time right now.  And no, that doesn&#8217;t mean it will be
done by tonight, I&#8217;ve got plenty of other stuff to do before then.</p>

<p>Also, I switched many of my redirects from 302 (temporary) to 301
(permanent) yesterday, however <a href="http://www.bloglines.com/">BlogLines</a>
doesn&#8217;t seem to have taken the hint.  Any ideas on how you can force
BlogLines to recognize a 301 and update its database if its repeatedly
received?  Also, I&#8217;m wondering why the request from BlogLines don&#8217;t
include the
<a href="http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers">If-modified-since or the If-none-match headers</a>?
If they did it would save them bandwidth and the hassle of having to
parse thousands of feeds that aren&#8217;t updated on a daily basis.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/weblog/blog/page/21/">&larr; Older</a>
    
    <a href="/weblog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/weblog/blog/page/19/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/weblog/2012/05/10/static-bloggin/">Static Bloggin</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/28/i-am-not-a-climatologist-and-neither-are-most-of-these-people/">I am not a climatologist, and neither are most of these people</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/10/looking-for-summer-interns-in-the-software-technology-group-at-ibm-tj-watson-research-center/">Looking for Summer Interns in the Software Technology Group at IBM TJ Watson Research Center</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/a-review-of-2011-personal-development-goals/">A Review of 2011 Personal Development Goals</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/open-source-and-technology-predictions-for-2012/">Open Source and Technology Predictions for 2012</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pridkett">@pridkett</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pridkett',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/weblog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("pridkett", 4, false);
    });
  </script>
  <script src="/weblog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/pridkett" class="twitter-follow-button" data-show-count="false">Follow @pridkett</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102672530623465237388?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Patrick Wagstrom -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
