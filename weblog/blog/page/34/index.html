
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Delusional Dream</title>
  <meta name="author" content="Patrick Wagstrom">

  
  <meta name="description" content="It was a peaceful Saturday morning. The sun was out. The skies were blue. A few birds were singing. Overall it was one of those beautiful late May &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://patrick.wagstrom.net/weblog/blog/page/34">
  <link href="/weblog/favicon.png" rel="icon">
  <link href="/weblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/weblog/javascripts/modernizr-2.0.js"></script>
  <script src="/weblog/javascripts/ender.js"></script>
  <script src="/weblog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/weblog/atom.xml" rel="alternate" title="My Delusional Dream" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/weblog/">My Delusional Dream</a></h1>
  
    <h2>Thoughts of a cautious technocrat</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/weblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:patrick.wagstrom.net/weblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/weblog/">Blog</a></li>
  <li><a href="/weblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/27/aheftydoseofslashdotting/">A Hefty Dose of Slashdotting&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-27T18:12:00-04:00" pubdate data-updated="true">May 27<span>th</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>It was a peaceful Saturday morning.  The sun was out.  The skies were blue.  A few birds were singing.  Overall it was one of those beautiful late May days here in Chicagoland.  I was completely unaware that coming my way was attack which no mere mortal could stand in the way of, the <a href="http://www.wikipedia.org/wiki/Slashdot_effect">slashdot effect</a> was heading my way.</p>

<p>I began by thinking that my <a href="http://www.sprintbroadbanddirect.com/">broadband connection</a> was just a little slow.  I was browsing CNN and Slashdot some and it seemed a little slow.  I attributed this, at first, to some over aggresive filters that I had running.  You see, I run a healthy dose of portsentry on my computer.  This means that quite frequently sites get blocked if they try to open connections to my computer.  In the past this has blocked CNN and OSDN&#8217;s ad servers, IIT&#8217;s webmail, and a host of other sites that I find generally useful.</p>

<p>Anyway, stuff was slow, so I reloaded slashdot for about the fifth time that morning, and that&#8217;s when I saw the horror.  My weblog had made front page news on slashdot.  The fury was about to begin&#8230;</p>

<h4>The Beginning</h4>

<p>The original article was posted to my web page at 4:30pm CDT on May 23rd, 2003.  Shortly afterwards I posted a comment on <a href="http://www.deadly.org/commentShow.php3?sid=20030522084624&amp;pid=45">this thread</a> at <a href="http://www.deadly.org/">deadly.org</a> which had inspired my work in the first place.  The time of that comment was about 10 minutes later (deadly is in eastern time).  It&#8217;s unfortunate that deadly didn&#8217;t automatically linkify it like it was supposed to because I can&#8217;t track how many people came to visit it after that.</p>

<p>CowboyNeal posted the article on the slashdot homepage at 9:10AM CDT on May 24th, 2003.  Previous to this point in time there was not a single person who followed a referrer to my page.  Meaning that <a href="http://www.slashdot.org/">slashdot</a> was the first link that was pointed to my site.  The first reference to slashdot that appears in my log was from cache-1.atw.pa.webcache.rcn.net, it&#8217;s hard to tell if this is the person who submitted the article, or a slashdot editor.  My hunch is that  the slashdot editor used the address 24.247.221.123.kzo.mi.chartermi.net as I&#8217;m pretty sure they all still live in the Holland/Grand Rapids/Kalamazoo area.  These first hits started around 8:53AM CDT.</p>

<p>Previous to this point I had received 39 visits to the page with no referrer tag marked.  This means that deadly has higher traffic than I thought as there were 39 people willing to paste the URL I posted into their location bars.  Another interesting thing is the number of people who used the near future feature of slashdot was fairly low.  Only 14 hits registered a referrer from slashdot before 9:10AM CDT on May 23rd.</p>

<h4>The Initial Onslaught</h4>

<p>At 9:10AM we saw the initial barrage begin.  I figure that at this point it was the actual posting of the article on slashdot because the hits started to come fast and furiously.  What we see below is a plot of the hits versus time for the first few hours.  The red steps are the hits that I received for that minute and the green line is the smoothed version of those results using gnuplot&#8217;s bezier option.  It&#8217;s not a true trend line, but it&#8217;s good enough for my work here.  This graph includes only requests for the actual document, and not the associate style sheets.</p>

<p><img src="/weblog/images/graphs/hits2.png" alt="" /></p>

<p>We can see that the server peaked around 1 request per second for the page.  With associated requests for browsers that automatically request favicon.ico and the stylesheet this would be multiplied by a factor of two to three.  It also should be noted that ideally only one of those requests would go out and try to fetch the hostname of the requesting host, although I can&#8217;t be sure of that because I didn&#8217;t collect that information.</p>

<p>Another issue of concern was the total bandwidth that was being consumed.  While I don&#8217;t have a 100% accurate way of measuring this, I can get a good estimate based off the number amount of data the apache says it sent each minute.  This shows the bandwidth consumption for the initial slashdot effect and includes the css sheet, but it does not include the HTTP headers that were sent and the overhead if the data was chunked.</p>

<p><img src="/weblog/images/graphs/bandwidth1.png" alt="" /></p>

<p>Surprisingly enough, it seems like the actual server processes held up pretty well.  The computer that runs these servers is nothing spectacular, that&#8217;s for sure.  It&#8217;s a little K6-200 with 4 gigs of hard disk and 96 megs of ram; network connectivity is done via 2 ISA ethernet cards.  During the slashdotting I had no problem sshing into the computer on the second interface and looking around.</p>

<p>When I logged in I saw that the total system load was around 0.7.  This was at the peak of the slashdotting.  I also looked at the number of running httpd servers, it was around 30 or so.  This is far less than the 150 max servers that I had set in the configuration file.  I did notice things were a little slow and eventually traced this back to MySQL dieing a brutal death.  Apparently it <a href="http://www.deadly.org/article.php3?sid=20030523184136">only recently became stable on current</a>. This is the first time that I had problems with MySQL under OpenBSD, so I would have never known it was unstable.  This is also why there are no comments from the peak of the slashdotting.  People just couldn&#8217;t connect to the mysql server.</p>

<h4>The After Effects</h4>

<p>After I realized that my broadband connection wasn&#8217;t going to be of any use for the near future and observed that it was one of those very rare days in Chicago when the weather was actually nice, I decided to leave the system be and go outside.  I returned later that night and found that my broadband connection was very usuable again, and almost to the point where it seemed like nothing happened.</p>

<p>The following graphs provide more information on how the slashdot effect slows down.  It seems like it has an exponential decay in the number of requests.</p>

<p><img src="/weblog/images/graphs/hits3.png" alt="" /></p>

<p><img src="/weblog/images/graphs/hits1.png" alt="" /></p>

<p><img src="/weblog/images/graphs/bandwidth2.png" alt="" /></p>

<p>It&#8217;s pretty clear that by 6 hours after the initial posting to slashdot, my broadband connection was easily usuable again.  By 12 hours after the initial slashdotting the stream had slowed to a point where it would be very hard to even tell that a slashdotting had occurred.</p>

<h4>Collateral Damage</h4>

<p>As mentioned in the article, this was all inspired by some images on <a href="http://www.benzedrine.cx/">Daniel Hartmeier&#8217;s</a> site.  I also linked to those images.  After the slashdotting I requested and received the logs from his site for the related images and found some interesting information.  First of all, there were 6275 total requests made to his site because of this article.  Of which 5528 came from my copy of the article, and 747 came from the mirror that slashdot posted at <a href="http://lmo.warcry.com/">lmo.warcry.com</a>.</p>

<p>These two graphs illustrate the bandwidth used only by references from the two links on slashdot.  I didn&#8217;t try to track visits and see how much total bandwidth was consumed if someone clicked to go to the index page and then browsed around for a long time.  These are only cases where the referrer is one of the two sites on slashdot.  The first one is for the first four hours of the slashdotting, the second one is for the 48 hours after the slashdotting.  Once again, these represent the bandwidth only as his web server, thttpd, reported it.</p>

<p><img src="/weblog/images/graphs/benzedrine.bandwidth1.png" alt="" /></p>

<p><img src="/weblog/images/graphs/benzedrine.hits1.png" alt="" /></p>

<p>This should be a concern for anyone that links to things on the web, especially if you know that page might be slashdotted.  From reading Daniel&#8217;s page, he states that he has a 128Kbps dsl line.  This means that his upstream is capped around 100Kbps after you factor in PPOE overhead.  Thus, at the initial onset, when it was averaging to over 5k/s, with spikes up to 10k/s, the links alone were consuming a substantial portion of his bandwidth.</p>

<p>Moving along, we see that the requests on the linked site follows almost the exact same pattern as the request to the slashdotted site.  There is a nice exponential decrease, however it isn&#8217;t quite as obvious because of the lower number of site visits.</p>

<p><img src="/weblog/images/graphs/benzedrine.bandwidth2.png" alt="" /></p>

<p><img src="/weblog/images/graphs/benzedrine.hits2.png" alt="" /></p>

<p>For the sample period in question, there were 11624 unique hosts that accessed the original document and 1858 unique hosts that accessed the mirrored document.  Of those hosts there were 3290 hosts that accessed clicked through the links to see the pictures that provided my motivation.  This means that there was 23.7% overall clickthrough rate on the links (28.7% from the mirror at warcry and 23.4% from the original document).  I&#8217;d like to see web advertises do that!</p>

<p>Now we&#8217;re on to the stuff that just doesn&#8217;t make any sense.  Of the 3290 hosts that clicked through to benzedrine.cx, 239 of them clicked through from both the original document and the mirror.  One has to wonder what these people were thinking.  There were 637 hosts that visted both the original site and the mirror site.  Meaning that in reality the mirror site only received about 1200 hits.  By the time that the mirror was posted, the brunt had slowed down and it really didn&#8217;t matter anymore.</p>

<h4>Preventative Measures</h4>

<p>This whole document would be fairly useless unless I had actually applied some changest to help avoid a slashdotting in the future.  Whill, you can&#8217;t really avoid it, unless you never post anything useful.  So a better title might be dealing with slashdottings.  I&#8217;ve listed a few pretty simple steps here that can help out in that respect.</p>

<p>The first is to turn off hostname lookups in your http log files.  I had mine enabled because I happen to like looking at the log files and easily seeing where people came from, however, it means that most connections require an addition connection to the name server.  Even though the nameserver was running locally, for an uncached address, this meant significant overhead.  If you&#8217;re running <a href="http://httpd.apache.org/">apache</a> look in your configuration file and make sure the following line exists:</p>

<pre><code>#
# HostnameLookups: Log the names of clients or just their IP addresses
# e.g., www.apache.org (on) or 204.62.129.132 (off).
# The default is off because it'd be overall better for the net if people
# had to knowingly turn this feature on, since enabling it means that
# each client request will result in AT LEAST one lookup request to the
# nameserver.
#
HostnameLookups Off
</code></pre>

<p>Another interesting point is that I was bandwidth limited in this slashdotting.  As noted before, my server load never crept above 0.7 (and once I fixed MySQL, it stayed around 0.4).  The solution is to install mod_gzip (there would be a link to the webpage here, but the webpage appears to have gone missing).  Almost every modern web browser supports using gzip compression to on the fly compress web pages.  Being as the slashdot effect linked to my weblog, which is nothing but html and css, it&#8217;s not a problem to compress it.  Mod_gzip takes advantage of this.  You can find it in ports/www/mod_gzip.</p>

<p>Finally, I&#8217;m working on some additional tools.  I&#8217;m writing my own mod_slashdotting module.  I&#8217;m not sure if I&#8217;ll ever release it or not, but I bought the apache module book a few years ago and have yet to create anything productive from it.  The basic premise is this.  If the server detects more then <em>n</em> hits in <em>m</em> minutes, it will use will either shut down or use some dynamic pf rules to forward all traffic to a more powerful server.    Not quite sure how all the mechanics of it are going to work yet.</p>

<p>Also, I&#8217;m doing some work stuff with altq in OpenBSD 3.3.  This lets me limit my upstream bandwidth used by HTTP servers to an arbitrary amount.  Thus, if I get slashdotted again, while slashdot can complain about not being able to reach my web page, at least I&#8217;ll still be able to access the rest of the network because I&#8217;ll have a slice of bandwidth available for me.</p>

<h4>Comments On My Site</h4>

<p>After seeing some of the comments on my site, it&#8217;s clear why slashdot has a moderation system.  There were a lot of comments along that seemed to be made by 12 year olds (or people about the same level) that just were happy that they could make my website curse.  That&#8217;s pretty clever considering there already are curses on my website in various rants.  Anyway, it shows that for a decent traffic site, human moderation is helpful.</p>

<p>This is very clear in reading the quality of the comments.  Although things more easily swayed off topic on slashdot, the comments seemed longer and more robust.  Most comments on my website were short and to the point.  Perhaps this has something to do with karma-whoring nature of many slashdotters.</p>

<h4>Conclusion</h4>

<p>The first thing that can be seen is that if your site gets slashdotted, don&#8217;t worry, it&#8217;s only temporary.  Take the rest of the day off and go outside and do something else.  It will be better in a few hours anyway.  This is largely because slashdot traffic roughly follows an exponential decay model.</p>

<p>Another observation is that a well written article can get click through rates that web advertises only dream of.  A devious author could hide some links to pay-for-click sites in their HTML and make a tidy profit.  I also wonder what the actual click through rate would have been for a site like Amazon where you can get a kickback if people buy the books that you reference.</p>

<p>One of the most interesting observations is how little a mirror site really helps in the case of a slashdotting. Either very few people choose to visit it, or by the time that it gets posted most people have already seen it.  An interesting note is that the clickthrough on the mirror site was higher than the original.  Perhaps future studies of the slashdot effect could help determine if this is a consistent thing, or just for this one article.</p>

<p>There were two rather disturbing results from this study.  One is the power of slashdot to cause collateral damage.  The documents I provided were very small static documents, while the documents that I linked to on benzedrine.cx were quite larger. This caused a significant amount of collateral damage to his site, based on my site being slashdotted.  Secondly, the large amount of people who not only visited both the mirror and the original site, but the people who clicked through from both, seems quite high.  I have to wonder why these people do such actions.  Do they think that the article will be different at the different hosts?</p>

<p>Overall, I can say that the slashdot effect is no big deal.  It saturated my broadband line for a short period, and I was a little worried that if it kept up Sprint might cancel my connection, but it slowed down quite quickly and in retrospect the bandwidth consumed is less than that of your average p2p user.</p>

<h4>Acknowledgements</h4>

<p>A substantial amount of this analysis would not have been possible without Daniel Hartmeier of benzedrine.cx and Lewt from lmo.warcry.com providing their httpd logs to me.  Thank you very much for your help.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/27/slashdoteffectdataanalysistechniques/">Slashdot Effect Data Analysis Techniques</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-27T10:02:00-04:00" pubdate data-updated="true">May 27<span>th</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h4>Addendum: How the Data Was Analyzed</h4>

<p>This section of information is really part of the article.  It&#8217;s more just a reference for those of you who might want more information on how the data was analyzed.  This section shows the tricks that I used so if you get slashdotted you can figure out what happened too.</p>

<p>The first piece of required information was to get just the views of the article in question.  This was done via a series of grep commands that first found the references to the page in question, then eliminated references to css and icons.  The next two greps eliminated any access that I might have made.  I performed all the analysis on a remote computer that had access to the log via <strong>/mnt/scissors/www/logs/patrick.wagstrom.net-access_log</strong>.  The following command was used to get all the references:</p>

<pre><code>cat /mnt/scissors/www/logs/patrick.wagstrom.net-access_log | \
grep /weblog/archives/000128.html | grep -v css | grep -v ico | \
grep -v host106 | grep -v 192.168.1.2 &gt; access_log
</code></pre>

<p>This created a file called <strong>access_log</strong> in my current directory.  The next step was to do some analysis of the file.  This was accomplished via the following PERL script, called <strong>webplot.pl</strong>:</p>

<pre><code>#!/usr/bin/perl -w
$lastday = -1;
$lasthour = -1;
$currcount = 0;
while(&lt;&gt;){
   if(/\.html/){
        @results = split;
        $day = int(substr($results[3],1,2));
        $hour = int(substr($results[3],13,2));
                if ($day ne $lastday || $hour ne $lasthour) {
                        if ($lastday != -1) {
                                printf ("2003/05/%d %02d:00 %d\n", $lastday, $lasthour, $currcount);
                        }
                        $lastday = $day;
                        $lasthour = $hour;
                        $currcount = 0;
                }
                $currcount ++;
    }
}
printf ("2003/05/%d %02d:00 %d\n", $lastday, $lasthour, $currcount);
</code></pre>

<p>This initial version provided a listing by hour of all of the hits that the site had taken.  However, I also wanted to get the hits by minute for some finer grain resolution.  This required the creation of another script, <strong>webplot2.pl</strong> that read in the data and did a minute by minute analysis.</p>

<pre><code>#!/usr/bin/perl -w
$lastday = -1;
$lasthour = -1;
$lastminute = -1;
$currcount = 0;
while(&lt;&gt;){
   if(/\.html/){
        @results = split;
        $day = int(substr($results[3],1,2));
        $hour = int(substr($results[3],13,2));
        $minute = int(substr($results[3],16,2));
                if ($day ne $lastday || $hour ne $lasthour || $minute ne $lastminute) {
                        if ($lastday != -1) {
                                printf ("2003/05/%d %02d:%02d %d\n", $lastday, $lasthour, $lastminute, $currcount);
                        }
                        $lastday = $day;
                        $lasthour = $hour;
                        $lastminute = $minute;
                        $currcount = 0;
                }
                $currcount ++;
    }
}
printf ("2003/05/%d %02d:%02d %d\n", $lastday, $lasthour, $lastminute, $currcount);
</code></pre>

<p>To process all of this data, I needed a way to visualize it.  Luckily, <a href="http://www.gnuplot.info/">gnuplot</a> can plot just about everything you can throw at it.  I used the following script to generate the graphs.  It assumes that output from <strong>webplot.pl</strong> was in <strong>out.log</strong> and the output from <strong>webplot2.pl</strong> was in <strong>out2.log</strong>.</p>

<pre><code>set output 'hits1.png'
set terminal png small
set ylabel "hits"
set title "hits per hour"
set grid
set timefmt "%Y/%m/%d %H:%M"
set xtics rotate
set xdata time
set xrange ["2003/05/24 00:00":"2003/05/27 00:00"]
set xtics "2003/05/24 00:00", 14400, "2003/05/27 00:00"
set format x "%b %d %H:%M"
set size 1.5,0.75
set key below title
plot 'out.log' using 1:3 title "Hits" with steps

set title "hits per minute"
set output 'hits2.png'
set xrange ["2003/05/24 15:00":"2003/05/24 19:00"]
set xtics "2003/05/24 00:00", 1800, "2003/05/27 00:00"
plot 'out2.log' using 1:3 title "Hits" with steps
</code></pre>

<p>Now that I had my nifty graphs, which of course you need to have people look at your page, I needed to ip addresses out of my access log, which still had the hostname in them.  This was mainly because the other sites that I received access logs from all had hostnames turned off.  This nifty command will parse an access log and print out all the ip addresses:</p>

<pre><code>for x in `cat access_log | cut -d ' ' -f 1`; \
      do echo `host $x | sed -e "s/.* has address //"`; done
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/23/lpdforfunandmp3playing/">LPD for Fun and MP3 Playing</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-23T15:30:00-04:00" pubdate data-updated="true">May 23<span>rd</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h4>Background</h4>

<p>Most true Unix geeks will recognize just how nice LPD is as a distributed queueing mechanism for managing all jobs sent to the printer.  It has a beautiful simplicity to it, and some mean power to go along with it.  It&#8217;s a difficult beast to tame, but once you understand it, everything will start coming out exactly like you want it.</p>

<p>But, what most people don&#8217;t realize is that LPD can be used for other things too.  In fact, it can be viewed as a general queueing mechanism with a few added bells and whistles for printers.  So let&#8217;s examine a more interesting use of LPD, an engine for distributed spooling of MP3s.</p>

<h4>Motivation</h4>

<p>The main thing that got me started on this quest was seeing these two pictures (<a href="http://www.benzedrine.cx/c2k3/DSC00550-medium.jpg">one</a>, <a href="http://www.benzedrine.cx/c2k3/DSC00567-medium.jpg">two</a>) from the <a href="http://www.benzedrine.cx/c2k3/">c2k3 openBSD hackathon</a> I saw that obviously someone else had figured out how to do it.  I sure as heck could also.</p>

<h4>Initial Assessment</h4>

<p>The first stop on my quest was examine the all-knowing seer of the Internet, <a href="http://www.google.com/">google</a>.  That returned a <a href="http://www.update.uu.se/~peterl/html/sub_hobbies/comp/hacks/mp3skrivare.html">wonderful page in Swedish</a> about how to do this very task.  Unfortunately, my swedish sucks, but thankfully the scripts were written in bash, and the other big thing was just a printcap file.</p>

<h4>Creating a Printcap Entry</h4>

<p>The first thing that you need to do is to create an entry in your printcap file for your shiny new mp3 printer.  On most systems this file is <strong>/etc/printcap</strong> on my <a href="http://www.redhat.com/">redhat</a> 7.3 system (no sound card on the openBSD firewall) it is <strong>/etc/printcap.local</strong>.  You&#8217;ll want to paste the following snipped of code in there:</p>

<pre><code>mp3:\
        :lp=/dev/null:\
        :sd=/var/spool/lpd/audio:\
        :if=/usr/local/bin/audiofilter:\
        :af=/var/log/audio-acct:\
        :lf=/var/log/audio-errs:\
        :sh
</code></pre>

<p>Now we&#8217;ll walk through the entry line by line.  I&#8217;ll ignore the \ at the end of almost every line, that just tells lpd to keep reading because there is more to come.  The last line doesn&#8217;t need the \ obviously.</p>

<ul>
<li><p>1: <strong>mp3:</strong> - the name of your mp3 printer.  In this case, just mp3</p></li>
<li><p>2: <strong>:lp=/dev/null:</strong> - we&#8217;re not hooking this up to a physical device in the normal sense</p></li>
<li><p>3: <strong>:if=/usr/local/bin/audiofilter:</strong> - this is the input filter.  I&#8217;ll show how to create it later.</p></li>
<li><p>4: <strong>:af=/var/log/audio-acct:</strong> - this is the accounting file.  You could do some fun stuff with this to monitor who uses the queue the most and what not.</p></li>
<li><p>5: <strong>:lf=/var/log/audio-errs:</strong> - this is the file that errors will be logged to.  Well, some errors; not all errors will end up here.</p></li>
<li><p>6: <strong>:sh</strong> - tells it to supress any header information that would normally be sent.  This is important or you may get junk before every file which causes audiofilter to fail.</p></li>
</ul>


<h4>An Audio Input Filter</h4>

<p>The key to the whole system is that all of the processing is done by input filter.  On some platforms this may cause it say that the printing has stalled while a song is playing, but that&#8217;s not a big deal.  There is no output from the input filter, and thus nothing is done after this.  You&#8217;ll want to put the following piece of code on your system as <strong>/usr/local/bin/audiofilter</strong>:</p>

<pre><code>#!/bin/bash
#
# This script was originally made by Teddy Hogeborn.
# Small alterations was made by:
#   Peter Lundqvist
#   Patrick Wagstrom
#
# This is a "printer filter" for playing audio files

for arg in "$@"; do
  case "$arg" in
    -d*) dir="${arg#-d}" ;;
    -e*) basefile="${arg#-e}" ;;
    -f*.*) ext="${arg##*.}" ;;
  esac
done

mp3player="mpg123 -q -o oss";
modplayer="mikmod --quiet --playmode 0 --noloops --norc"
oggplayer="ogg123 --device=oss --quiet"
file="${dir}/${basefile}"
type="$(file "${file}"| sed -e 's/^[^:]*: *//')"

case "$type" in
  MP3*)
    $mp3player -
    ;;
  Ogg*Vorbis*)
    $oggplayer -
    ;;
  RIFF*\ WAVE\ audio*)
    /usr/bin/play --type=wav --silent /dev/stdin
    ;;
  *Extended\ Module\ sound\ data*|*Protracker\ module\ sound\ data*)
    $modplayer $file
    ;;
  data|*audio*)
    if ogginfo "$file" 2&gt;/dev/null | grep --quiet -e '^header_integrity=pass' &gt;/dev/null; then
      $oggplayer -
    elif mp3info -x "$file" 2&gt;/dev/null| grep --quiet -e '^File:' &gt; /dev/null; then
      $mp3player -

    else
      play --type=auto --silent "$file" || play --type="$ext" --silent "$file"
    fi
    ;;
  *) echo "$type" &gt;&amp;2 ;;
esac
</code></pre>

<p>Here is the basic overview of what the system does.  The beginning of the code parses the arguments that are passed to the print filter from the printer.  It then stores them in a couple of variables.  It then has some declarations for where you can find your mp3, ogg, and mod player.  You should note, this system is also extensible with little difficulty.</p>

<p>After this the format of the file is obtained by running the program <strong>file</strong> on it.  This nifty little tool that most people overlook will examine a file and usually can provide a pretty good guess about what sort of file it is.  It&#8217;s great at identifying files with incorrect extensions where you&#8217;d otherwise never be aware of it.</p>

<p>Finally, the options for the type of the file are parsed in a case statement and then the appropriate player is called.  In all cases, the input stream is fed over standard input.  The applications should be quiet, lpd usually assumes that if there is any output from a filter that something has gone wrong.</p>

<p>You may need to modify this script some.  The main reason is that not all version of the <strong>file</strong> utility return the same strings.  Some return &#8220;MPEG 2 layer 3 audio&#8221; for an MP3 file, while mine returns &#8220;MP3, 128 kBits, 44.1 kHz, Stereo&#8221; or something similar.  Thus, you may need to modify the values for the case statement some to get the system to your liking.</p>

<h4>Accessing the Sound Card</h4>

<p>Up to this point we haven&#8217;t done anything that could be considered a big security risk.  This point is minor, but you need to give the account for your printer access to the sound card so it can play the music.  This is done by giving it right to write the <strong>/dev/audio</strong> and <strong>/dev/dsp</strong>.  If you&#8217;re lazy you could just do a <strong>chmod a+rw /dev/audio /dev/dsp</strong>, but that allows all sorts of people to do things with your sound card.  You&#8217;re better off putting all people with rights to the sound card in a group and then also putting the lp account in the group too.  For instance, creating a group called <strong>snduser</strong> with all the accounts that have access to the card in it, and also the lp account.  The doing <strong>chgrp snduser /dev/audio /dev/dsp</strong> and <strong>chmod g+rw /dev/audio /dev/dsp</strong> should take care of it for you.</p>

<p>While you&#8217;re creating files, you&#8217;ll need to create those two accounting files that I mentioned in the <strong>/etc/printcap</strong> entry.  You can do this by running the following commands:</p>

<pre><code>touch /var/log/audio-acct
touch /var/log/audio-errs
chown lp /var/log/audio-acct
chown lp /var/log/audio-errs
</code></pre>

<h4>Enjoying The Music</h4>

<p>The final step is to enjoy the music.  Provided that you&#8217;ve done everything right so far you should be able to execute <strong>lpr -Pmp3 [your music file]</strong> and shortly afterwards it should start playing for your speakers.</p>

<p>One of the really nice things about this is that you can use <strong>lpq</strong> to see what songs are on the queue and <strong>lprm</strong> to remove a song from the queue.  Here is an example (yes, I own the albums):</p>

<pre><code>[/u2/mp3]
[patrick@dreams] &lt;strong&gt;lpr -Pmp3 Wally\ Pleasant\ -\ Alternateen.mp3&lt;/strong&gt;
[/u2/mp3]
[patrick@dreams] &lt;strong&gt;lpr -Pmp3 Wally\ Pleasant\ -\ Bigger\ Than\ Elvis\ -\ Wally\ World.mp3&lt;/strong&gt;
[/u2/mp3]
[patrick@dreams] &lt;strong&gt;lpr -Pmp3 Wally\ Pleasant\ -\ In\ Love\ with\ a\ Geek.mp3&lt;/strong&gt;
[/u2/mp3]
[patrick@dreams] &lt;strong&gt;lpr -Pmp3 Wally\ Pleasant\ -\ It\'s\ a\ Beautiful\ Day.mp3&lt;/strong&gt;
[/u2/mp3]
[patrick@dreams] &lt;strong&gt;lpq -Pmp3&lt;/strong&gt;
Printer: mp3@dreams
 Queue: 4 printable jobs
 Server: pid 7043 active
 Unspooler: pid 7044 active
 Status: waiting for subserver to exit at 16:22:55.342
 Rank   Owner/ID                  Class Job Files                 Size Time
active patrick@dreams+42            A    42 Wally Pleasant - A 2727348 16:22:38
2      patrick@dreams+50            A    50 Wally Pleasant - B 2679246 16:22:42
3      patrick@dreams+52            A    52 Wally Pleasant - I 3266864 16:22:49
4      patrick@dreams+54            A    54 Wally Pleasant - I 3469897 16:22:55
</code></pre>

<h4>It&#8217;s not working!</h4>

<p>Contrary to what you may be thinking, the first step if this is not working is not to e-mail me about your system configuration.  I probably won&#8217;t be much help.  The first step is to go into the spooling directory, in this case <strong>/var/spool/lpd/audio</strong> and see what&#8217;s lying in there.  The file that you&#8217;ll want to look at is <strong>status.pr</strong>.  This provides the status of your printer.  If there was any output from the script, it will be saved in there.  Look around in there and use that for a debugging point.</p>

<h4>Questions/Follow-up Ideas</h4>

<p>If you&#8217;ve got a question about this article and think it&#8217;s something that should be addressed more, let me know.  Also, if you&#8217;ve got an idea for a followup, I&#8217;d like to hear those also.   I&#8217;m always looking for interesting new hacks to try out and experiment with.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/22/ipv6applications/">IPv6 Applications</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-22T23:04:00-04:00" pubdate data-updated="true">May 22<span>nd</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>In <a href="http://patrick.wagstrom.net/weblog/archives/000125.html">yesterday&#8217;s article</a> I wrote about how to get <a href="http://www.openbsd.org/">OpenBSD</a> and IPv6 to play nicely together, so you could get some basic applications running.  Today, I&#8217;m going to go into some more depth and tell about how to get some applications going.</p>

<h4>Finding Hostnames</h4>

<p>One of the most basic things that you&#8217;ll want to do is look up hostnames on the Internet.  For IPv4 an address record is an A record, for IPv6 it is an AAAA record. Thus, to get the IPv6 address for a host run the command <strong>dig [hostname] AAAA</strong> to get the record.</p>

<h4>Web Browsing</h4>

<p>The first that you&#8217;ll probably want to get going is web browsing.  If for nothing else than allowing you see the wonderful <a href="http://www.kame.net/">dancing kame</a>.  The great thing is that for newer versions of <a href="http://www.mozilla.org/">Mozilla</a>, <a href="http://www.konqueror.org/">Konqueror</a>, and <a href="http://galeon.sf.net/">Galeon</a> you don&#8217;t need to do anything.  By default if a host also has an IPv6 address, it will try to access it over IPv6.  The problem comes when you try to enter IPv6 addresses into your address bar, usually they&#8217;ll get mangled.  To fix this, for an address you can put the address in brackets.  Thus, you should see that <a href="http://www.wagstrom.org/">http://www.wagstrom.org/</a> and <a href="http://%5B2001:470:1f00:572::1%5D/">http://[2001:470:1f00:572::1]/</a> will take you to the same location, which is my little IPv6 test web server.</p>

<h4>Web Servers</h4>

<p>I&#8217;ve read some stuff that <a href="http://httpd.apache.org/">Apache</a> apparently has IPv6 support built in natively as of version 2.  Unfortunately, the chroot version of it in OpenBSD is still based on version 1.3, so there is no IPv6 support, at least not that I could tell.  Because I&#8217;m lazy, I didn&#8217;t want to go and install a whole new version of Apache, after all, my current setup works fine and there is no reason to think people will currently get added benefit from accessing it under IPv6.</p>

<p>Looking for a simple solution I settled on <a href="http://www.acme.com/software/thttpd/">thttpd 2.23</a>.  This was pretty straight forward to compile, in fact no additional options were needed to get IPv6 support.  Then I wanted to start serving web pages from a special IPv6 directory under my normal html directory.  To do this, I added the following commands to <strong>/etc/rc.local</strong> to start up thttpd:</p>

<pre><code># thttpd startup
echo -n ' thttpd ipv6 webserver startup'
y=`pwd`
cd /home/patrick/public_html/ipv6
thttpd -p 80 -h 2001:470:1f00:572::1 -r
cd $y
</code></pre>

<p>This very simply echoes that it is starting up the web service.  Stores the current directory in a variable.  Changes into the director where the web pages are being served from, and then starts up an instance of thttpd.  The <strong>-p 80</strong> tells it to listen on port 80, while the <strong>-h 2001:470:1f00:572::1</strong> gives the IP address that the daemon should bind to.  A quick restart later (or just running the commands as root) and you should be able to access you brand spanking new IPv6 web server.</p>

<h4>SSH</h4>

<p>Probably one of the best reasons to use IPv6 is to avoid manual tunneling to get to a machine that resides behind a NAT device.  <a href="http://www.openssh.com/">OpenSSH</a> supports IPv6 natively.  Once you have IPv6 running, you&#8217;ll need to give the server a restart (so it will know to start listening on the IPv6) interfaces.  Then you can connect to it by referencing an IPv6 only hostname or IP address.  If the machine has entries for both IPv4 and IPv6 you can specify the -6 flag to force IPv6.  For instance:</p>

<pre><code>$ ssh -6 yourhost.ipv6.yourdomain.com
</code></pre>

<p>should connect to your designated host via IPv6.  You&#8217;ll get a good idea based on where the system says you&#8217;re coming from when you first log in.</p>

<h4>IRC</h4>

<p>Although most of the unix IRC clients claim to have support for IPv6, the only one I&#8217;ve been able to get to work successfully is <a href="http://www.bitchx.com/">BitchX</a>.  You&#8217;ll probably need to recompile it to enable IPv6 as the default compiled package for OpenBSD does not support IPv6.  You can do this by setting <strong>WITH_IPV6=yes</strong> if compiling from ports, or doing <strong>./configure &#8211;enable-ipv6</strong> if compiling from source.</p>

<p>After this point you&#8217;ll probably want to connect to an IPv6 irc server.  Two that I&#8217;ve had good luck with are irc.ipv6.homelien.no and irc.efnet.nl.  The problem, is that because both of these have IPv4 addresses you&#8217;ll need to manually give it the IP address of the server to connect to.  You then connect by doing the usual server command, but appending a comma to the hostname.  Thus <strong>/server 2001:840::1000,</strong> and <strong>/server 2001:7b8:3:3f:201:2ff:fef6:574e,</strong> will connect you to irc.ipv6.homelien.no and irc.efnet.nl respectively.  Once you have everything set up, you should see something like this when you do a whois:</p>

<pre><code>+----------------------------------------- --  -
| pridkett (patrick@dreams.ipv6.wagstrom.org) (Internic Non-Profit Organization)
| ircname  : patrick wagstrom
| channels : #openbsd
| server   : irc.ipv6.homelien.no (Who Cares -- IPv6!)
| away     : pridkett - is away: (Auto-Away after 10 mins) [BX-MsgLog On]
: idle     : 0 hours 22 mins 5 secs (signon: Thu May 22 16:25:40 2003)
</code></pre>

<p>However, you should be prepared to know that DCC will stop working unless that other person is using an IPv6 host.  So if you use IRC to talk, this is fine.  If you use IRC to download MP3s or warez, continue using IPv4.</p>

<h4>DNS</h4>

<p>Unfortunately, most DNS service providers do not support the AAAA record type, this includes <a href="http://www.dyndns.org/">dyndns.org</a> whom I use to administer wagstrom.net.  However, as I had wagstrom.org sitting around and not being used, I figured that I would get that set up.  The first thing that you need is a host with a static IPv4 address because nameservers still require IPv4 to work.  Then go and update your records to point your domain at your DNS, in my case this is at 66.1.1.250.</p>

<p>The version of BIND that ships with OpenBSD is IPv6 enabled, so once you get it going, you shouldn&#8217;t have any problems.  The first thing you need to do is edit <strong>/etc/rc.conf</strong> and change this line:</p>

<pre><code>named_flags=""          # for normal use: ""
</code></pre>

<p>This tells OpenBSD to start up the name server on the next boot.  Now you need to go to <strong>/var/named/etc</strong> and add your domain to your named.conf as you would an IPv4 domain.  In my case I did the following:</p>

<pre><code>zone "wagstrom.org" {
        type master;
        file "master/wagstrom.org";
        allow-transfer {
        };
};
</code></pre>

<p>You&#8217;ll want to change it for whatever your domain is.  The next step is to create the domain file.  This should reside in <strong>/var/named/master/wagstrom.org</strong>.  Here is what mine looks like:</p>

<pre><code>; File: wagstrom.org
; wagstrom.org network file
; support of IPv6 hostnames
;
@       IN      SOA     ns.wagstrom.org.        root.wagstrom.org.      (
        2003052101      ; serial number YYYYMMDDrr
        3H              ; refresh
        15M             ; retry
        1W              ; expiry
        1D )            ; minimum

        IN      NS      ns.wagstrom.org.
        IN      MX      10 scissors.wagstrom.net.
;
; Local Hosts
;
ns                      IN      AAAA    2001:470:1f00:572::1
                        IN      A       66.1.1.250
scissors.ipv6           IN      AAAA    2001:470:1f00:572::1
scissors.ipv4           IN      A       66.1.1.250
scissors                IN      CNAME   scissors.ipv4
www.ipv6                IN      CNAME   scissors.ipv6
</code></pre>

<p>Most of that  should be pretty straight forward.  I have different host names for my host for IPv4 (scissors.ipv4.wagstrom.org -> 66.1.1.250) and IPv6 (scissors.ipv6.wagstrom.org -> 2001:470:1f00:572::1).  In addition, I have ns.wagstrom.org mapping to both an IPv4 and an IPv6 address.  It&#8217;s important that this be in place and running for a while before trying to get reverse DNS to work.</p>

<h4>Reverse DNS</h4>

<p>One of the really nice features of <a href="http://tunnelbroker.net/">Tunnelbroker</a> is that it also allows you do your own reverse DNS.  Combined with the massive amounts of address space that IPv6 provides, this means a limitless number of virtual hosts with cool names like i.am.a.37337.hax0r.from.wagstrom.org for your use on IRC.  Or, more realistically, it makes it nicer for when you SSH to your other IPv6 boxes so you don&#8217;t have to guess what host it was from by the really long IP address.</p>

<p>To get all of this going you&#8217;ll want to log in to Tunnelbroker.  Then select your /64 allocation.  From your /64 allocation there is a spot to put the hostname of your name server.  I&#8217;m not sure, but I think it needs to resolve in both IPv4 and IPv6 address space.  If it doesn&#8217;t odds are that Tunnelbroker will come back and yell at you.  I can&#8217;t be sure because the docs are pretty sparse for it.</p>

<p>Anyway, so this assumes that Tunnelbroker has accepted your DNS.  Now comes the fun part, reverse DNS names for ipv6 are in the ipv6.arpa domain (older versions had them in the ipv6.int domain, you&#8217;ll probably want to use both for now as ipv6.arpa doesn&#8217;t work on <a href="http://www.freenet6.net/">freenet6</a> allocations).  The easiest way to do this is to use <a href="http://tools.fpsn.net/ipv6-inaddr/">the IPv6 reverse DNS zone builder</a>.  This handles the headache of converting your domain.  Follow their instructions and you should be good.</p>

<p>Otherwise, you can be a masochist and it by hand.  The first thing is to figure out what domains you&#8217;re going to be doing revese DNS for.  You do this by reversing the subnet (don&#8217;t forget to add your zeroes back in) and putting periods between them and finally smacking on a ip6.arpa at the end.  This 2001:470:1f00:572::/64 becomes 2.7.5.0.0.0.f.1.0.7.4.0.1.0.0.2.ip6.arpa.  That&#8217;s a mouthful.  Here&#8217;s the code that I put in my <strong>/var/named/etc/named.conf</strong> file:</p>

<pre><code>/* 2001:470:1f00:572::/64
 */
zone "2.7.5.0.0.0.f.1.0.7.4.0.1.0.0.2.ip6.arpa" {
        type master;
        file "master/ipv6.arpa";
        allow-transfer {
        };
};
</code></pre>

<p>That was fun. Now you get to do it for each of your hosts! Remember, those zeroes that disapper with the :: in the address, well ,they&#8217;re back.  So this is the contents of my <strong>/var/named/master/ipv6.arpa</strong> file:</p>

<pre><code>$TTL 3d ; Default TTL (bind 8 needs this, bind 9 ignores it)
@       IN SOA 2.7.5.0.0.0.f.1.0.7.4.0.1.0.0.2.ip6.arpa. wagspat.iit.edu. (
                2003052100        ; Serial number YYYYMMDDrr
                24h             ; Refresh time
                30m             ; Retry time
                2d              ; Expire time
                3d              ; Default TTL (bind 8 ignores this, bind 9 needs it)
)

; Name server entries
                                        IN     NS     scissors.wagstrom.org
; IPv6 PTR entries

; Subnet #1
$ORIGIN 2.7.5.0.0.0.f.1.0.7.4.0.1.0.0.2.ip6.arpa.

1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0         IN      PTR     scissors.ipv6.wagstrom.org.
</code></pre>

<p>If all goes well, in another few hours you should be able to log into IRC over IPv6 from your host and you&#8217;ll see your brand new IPv6 domain name coming up as the reverse DNS.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/22/openbsdandipv6minihow-to/">OpenBSD and IPv6 Mini How-To</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-22T01:01:00-04:00" pubdate data-updated="true">May 22<span>nd</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>After some mucking around, I&#8217;ve gotten IPv6 and OpenBSD to play nicely together.  Furthermore, I&#8217;ve got my OpenBSD box acting as a router for my other computers behind it, as such they all have globally addressable ipv6 addresses now too.  I got a lot of help from Carl Brewer&#8217;s page on <a href="http://rollcage.bl.echidna.id.au/IPv6/openbsd.html">making a 6bone router using OpenBSD</a>, but needed to do some small modifications to account for the changes between OpenBSD 2.8 and OpenBSD 3.3.</p>

<p>Here is the basic overview of what I needed to for this to happen.  Step 1 is to set up an IPv6 tunnel.  There are a variety of services that can do this for you, I&#8217;m using <a href="http://www.tunnelbroker.net/">TunnelBroker</a> from <a href="http://www.he.net/">Hurricane Electric</a> (good people, they&#8217;ve been long time supporters of <a href="http://www.php.net/">PHP</a>).</p>

<p>When you register on TunnelBroker, they&#8217;ll need information about your IPv4 endpoint.  Fortunately, I have a static IP address.  I&#8217;m not real sure how well this would work if I didn&#8217;t.  So let&#8217;s just hope that you have a static IP address (I may have to work around that when I move in a few months).  After registering your endpoint, it will take up to 24 hours for the tunnel to be set up (this is in contrast to places like <a href="http://www.freenet6.net/">freenet6</a> where you can get instant set ups, but my pings here seem to be lower, and you get more options here).</p>

<p>After your tunnel is initialized, log back into TunnelBroker and look at the example configuration.  Select OpenBSD from the list.  This should give a configuration something like this:</p>

<pre><code>ifconfig gif0 giftunnel 66.1.1.250 64.71.128.82
ifconfig gif0 inet6 alias 2001:470:1F00:FFFF::3B1 2001:470:1F00:FFFF::3B0 prefixlen 128
route -n add -inet6 default 2001:470:1F00:FFFF::3B0
</code></pre>

<p>You can feel free to run those commands right away.  Also make sure you paste those at the end of your <strong>/etc/rc.local</strong> configuration file.  You&#8217;ll also want to make sure that you&#8217;ve got a line to start rout6d in there too.  I have this hunk of code in mine:</p>

<pre><code># IPv6 Information
echo -n ' setting up IPv6 to he.net'
ifconfig gif0 giftunnel 66.1.1.250 64.71.128.82
ifconfig gif0 inet6 alias 2001:470:1F00:FFFF::3B1 2001:470:1F00:FFFF::3B0 prefixlen 128
route -n add -inet6 default 2001:470:1F00:FFFF::3B0
route6d
</code></pre>

<p>At this point you can try a ping6 to the other endpoint, which is the second set of numbers up there.</p>

<pre><code>ping6 2001:470:1F00:FFFF::3B0
</code></pre>

<p>If your ping6 went through, you&#8217;re in really good shape to get your own /64 subnet.  This is a MAMMOTH amount of address space, but hey, it&#8217;s IPv6.  Go to the page on TunnelBroker and select /64 Allocation.  Then just click submit, you can leave the fields blank for now until you set up ipv6 dns (which will be covered in another writeup).</p>

<p>The page will reload and it will contain text similar to this:
Assigned Prefix: 2001:470:1F00:572::/64</p>

<p>This is your /64 address space allocation from Hurricane Electric.  Requests for nodes on that subnet (which has a number of nodes equal to the square of the TOTAL number of IPv4 nodes) will be routed to your OpenBSD box.  The next step is to set up an ethernet interface to have an IPv6 address. In this case I chose to give device ne1, which is my internal network interface, an IPv6 address.  This is what my <strong>/etc/hostname.ne1</strong> now looks like:</p>

<pre><code>inet 192.168.1.1 255.255.255.0 NONE
inet6 alias 2001:470:1F00:572::1 64
</code></pre>

<p>The first line is the normal IPv4 address that I use for routing everything and talking to all my nodes that are natted.  The second line sets up an alias for IPv6.  While IPv6 does have this really cool concept of stateless autoconfiguration, we&#8217;re not going to use it here because this will be a router.  So I&#8217;ve chosen to give this interface the first address in my IPv6 address space.  The 64 indicates how many bits in my subnet, in this case, 64.  A reboot or a quick running of <strong>/etc/netstart ne1</strong> will bring the device up.  If you run a <strong>ifconfig ne1</strong> you should see something like this:</p>

<pre><code>ne1: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        address: 00:80:ad:1b:cd:b7
        media: Ethernet manual
        inet 192.168.1.1 netmask 0xffffff00 broadcast 192.168.1.255
        inet6 fe80::280:adff:fe1b:cdb7%ne1 prefixlen 64 scopeid 0x1
        inet6 2001:470:1f00:572::1 prefixlen 64
</code></pre>

<p>If you see the last line with your address, you should be good to go.  The second to the last line is the link identifier, but we&#8217;re not going to worry about that right now.  Unfortunately, we&#8217;re not quite ready to test our connection yet.  We need to set up the system so it does routing of IPv6 packets.  To do this you need to set the following lines in <strong>/etc/sysctl.conf</strong>:</p>

<pre><code>net.inet6.ip6.forwarding=1      # 1=Permit forwarding (routing) of packets
net.inet6.ip6.accept_rtadv=0    # 1=Permit IPv6 autoconf (forwarding must be 0)
</code></pre>

<p>These two options are mutually exclusive.  You can&#8217;t do auto configuration and also do routing, which makes sense, routers are supposed to have static addresses.</p>

<p>Now we get to muck around in <strong>/etc/rc.conf</strong> and set some more options.  Here are the ones that are important:</p>

<pre><code>rtadvd_flags=ne1        # for normal use: list of interfaces
                        # be sure to set net.inet6.ip6.forwarding=1
route6d_flags=""        # for normal use: ""
                        # be sure to set net.inet6.ip6.forwarding=1
rtsold_flags=NO         # for normal use: interface
                        # be sure to set net.inet6.ip6.forwarding=0
                        # be sure to set net.inet6.ip6.accept_rtadv=1
</code></pre>

<p>These options should make the route advertisement daemon start at boot time.   The last step you should have to do is to configure rtadvd.  You can do this by editing <strong>/etc/rtadvd.conf</strong> and inserting text similar to this:</p>

<pre><code>ne1:\
        :addrs#1:addr="2001:470:1F00:572::":prefixlen#64:tc=ether:
</code></pre>

<p>Where you&#8217;ll want to change ne1 to the proper device that you gave an ip to earlier and add to whatever your /64 allocation from TunnelBroker is.</p>

<p>Now, all you need to do is reboot and you should be good to go (you could start up everything manually, but rebooting is just as easy).  Now go back to TunnelBroker and select connectivity and try to ping the IP address you just created.  If all goes well, it should work.</p>

<p>If for some reason it doesn&#8217;t work, you might have very tight rules for pf.  Placing these rules in should help out some (see <a href="http://patrick.wagstrom.net/weblog/archives/000124.html">yesterday&#8217;s article for more on building a proper firewall</a>):</p>

<pre><code>pass in quick proto 41 from any to any
pass out quick proto 41 from any to any
</code></pre>

<p>Now comes the true test.  I&#8217;ve got a linux box (running a heavily modified version of RedHat 7.3) behind my OpenBSD router.  If you have an IPv6 module ready for your kernel you should be able to run <strong>modprobe ipv6</strong> and then your devices connected to your OpenBSD router will immediately get IP addresses.  Here&#8217;s what the output of <strong>ifconfig eth0</strong> looks like for me:</p>

<pre><code>eth0      Link encap:Ethernet  HWaddr 00:01:02:39:A5:67
          inet addr:192.168.1.2  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: 2001:470:1f00:572:201:2ff:fe39:a567/64 Scope:Global
          inet6 addr: fe80::201:2ff:fe39:a567/10 Scope:Link
          UP BROADCAST NOTRAILERS RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:9259 errors:0 dropped:0 overruns:0 frame:0
          TX packets:14256 errors:0 dropped:0 overruns:0 carrier:0
          collisions:21 txqueuelen:100
          RX bytes:2440576 (2.3 Mb)  TX bytes:2228114 (2.1 Mb)
          Interrupt:10 Base address:0xe800
</code></pre>

<p>The second inet6 line should be an IPv6 address.  If everything went as planned you should be able to go back to TunnelBroker and do a ping6 to that address and it should work.  Furthermore, browsing the web will now use IPv6 if possible.  This will get you the coveted <a href="http://www.kame.net/">dancing kame</a>.</p>

<p>Later on I&#8217;ll post a more in depth article on getting applications running under OpenBSD and Linux with IPv6.</p>

<p><strong>Update:</strong> I&#8217;ve completed my <a href="http://patrick.wagstrom.net/weblog/archives/000127.html">overview of IPv6 applications</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/21/openbsdandipv6/">OpenBSD and IPv6</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-21T05:28:00-04:00" pubdate data-updated="true">May 21<span>st</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>There used to be a good page at <a href="http://www.2600.org.au/">2600 Australia</a> about how to set up IPv6 with <a href="http://www.openbsd.org/">OpenBSD</a>, sadly that page is gone.  However, I did find a little gem from <a href="http://www.sans.org/">SANS</a> about <a href="http://www.sans.org/rr/paper.php?id=807">Building an IPv6 Firewall with OpenBSD</a>.  It looks a little up to date as it uses OpenBSD 3.0 (3.3 is the current version right now).  Anyway, when I get all mine set up all nice, I&#8217;ll post a good walkthrough on how to do it.  Then I&#8217;ll post another one once I get my computers behind my firewall to work over IPv6 also.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/20/migrationsuccessful/">Migration Successful?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-20T21:18:00-04:00" pubdate data-updated="true">May 20<span>th</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I think that the migration of my website to the openbsd server has been successful.  It took a lot longer than I wanted because first I had the two ethernet cards in the firewall mislabelled, then one wasn&#8217;t accepting DHCP addresses.  Now it seems like everything is all cool.  I must say, <a href="http://www.benzedrine.cx/pf.html">pf</a> is a very cool piece of software.</p>

<p>Anyway, there still are a few things that need to be taken care of on the system.  I don&#8217;t think that all of the scripts will be updating right away.  I need to work on that stuff.  The chroot webserver that OpenBSD uses might also cause some problems, so if you see any, email me and let me know.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/15/scowho/">SCO Who?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-15T14:28:00-04:00" pubdate data-updated="true">May 15<span>th</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today&#8217;s award Mohammed Saeed Al-Sahaf award for public misinformation goes to <a href="http://www.sco.com/">SCO</a>.  They&#8217;ve been involved in this whole <a href="http://www.linux.org/">Linux</a> lawsuit for (use Dr. Evil voice here) $1 billion dollars (end Dr. Evil voice) against <a href="http://www.ibm.com/">IBM</a>.  Anyway, SCO has a <a href="http://www.sco.com/scosource/quotes_from_leaders.html">page with quotes from Linux leaders</a> on their web page.  Here are some of the gems of the quotes:</p>

<blockquote><p>&#8220;Linux is a copy of UNIX. There is very little new stuff in Linux.&#8221;</p></blockquote>

<p>They attribute that to RMS, but the problem is that RMS didn&#8217;t say it!  <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0301.0/0972.html">Larry McVoy said it!</a>.  So lets ignore that and chalk one up as SCO being wrong&#8230;again.</p>

<blockquote><p>&#8220;I consider the law prohibiting the sharing of copies with your friend the moral equivalent of Jim Crow. It does not deserve respect.&#8221;</p></blockquote>

<p>This one is from RMS.  But I guess that&#8217;s where it becomes a good thing that RMS doesn&#8217;t write code for the kernel now isn&#8217;t it?</p>

<blockquote><p>&#8220;The whole GNU project is really one big hack. It&#8217;s one big act of subversive playful cleverness&#8230;&#8221;</p></blockquote>

<p>Another good one from RMS.  However, what SCO misses is that the Linux kernel, while licensed under the GPL is NOT part of the GNU project.  There are not pages for it at GNU.org.  In fact, the true GNU kernel is <a href="http://www.gnu.org/software/hurd/">HURD</a>.  So we can ignore that one.  Now let&#8217;s move on to quotes from Bruce Perens.</p>

<blockquote><p>&#8220;This is becoming a tradition. I go there and break the law every year in the name of free speech.&#8221;</p></blockquote>

<p>I don&#8217;t see how showing off <a href="http://www.kuro5hin.org/user/pridkett/info">DeCSS</a> is anything even vaguely related this issue.  Yes, I suppose they could use it to show a pattern of misuse within the Linux community, but that&#8217;s not what he was talking about in that reference.  The DMCA is the issue here, not software copyrights.</p>

<blockquote><p>&#8220;We have to remember that Linux is a follow-on to UNIX. It&#8217;s not just a UNIX clone. It&#8217;s actually a UNIX successor.&#8221;</p></blockquote>

<p>That&#8217;s entirely true.  However, implying that something is a successor doesn&#8217;t mean that it&#8217;s got stuff stolen from the original.  A Unix clone would be something that looks and acts like Unix, which linux and all the BSDs do on one level or another.  But something can be a clone and not be illegal, like <a href="http://www.phoenix.com/">Phoenix</a> Technologies original clean room PC clone bios.</p>

<p>So that sums it up.  Once again, SCO loses.  Show me some stuff that is factually accurate and I might believe their lawsuit has a snowball&#8217;s chance with Beelzebub.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/12/migration/">Migration</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-12T20:46:00-04:00" pubdate data-updated="true">May 12<span>th</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just a little note, I hope to be migrating this site back to OpenBSD this weekend.  It&#8217;s finally the end of the semester and I should have some time to get my old OpenBSD server back up an running.  That should alleviate some of the risks that I currently take with having my linux desktop act as the router.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/weblog/2003/05/09/ithinkthisismeanttobespam/">I Think This Is Meant to Be Spam</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2003-05-09T16:25:00-04:00" pubdate data-updated="true">May 9<span>th</span>, 2003</time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m not entirely sure if this is spam or not.  It&#8217;s pretty funny if it&#8217;s meant to be.  Someone must have ummm&#8230;issues&#8230;</p>

<p><strong>From:</strong> &#8220;&#8221; <a href="&#109;&#97;&#105;&#x6c;&#116;&#111;&#x3a;&#116;&#x6f;&#109;&#x6c;&#64;&#104;&#x61;&#x65;&#x6e;&#x61;&#109;&#46;&#x63;&#111;&#109;">&#116;&#x6f;&#109;&#108;&#x40;&#104;&#x61;&#101;&#x6e;&#97;&#109;&#x2e;&#x63;&#111;&#x6d;</a></p>

<p><strong>Date:</strong> Sat, 10 May 03 06:40:27 GMT</p>

<p><strong>Subject:</strong> Need Reliable Vendor npmyqsza x wk</p>

<p><strong>From</strong> toml@haenam.com  Fri May  9 05:48:09 2003</p>

<p>Greetings,</p>

<p>We need a vendor who can offer immediate supply.</p>

<p>I&#8217;m offering $5,000. US dollars just for referring a vender which is (Actually RELIABLE in providing the below equipment) Contact details of vendor required, including name and phone #. If they turn out to be reliable in  supplying the below equipment I&#8217;ll immediately pay you $5,000. We prefer to work with vendor in the Boston/New York area.</p>

<ol>
<li><p>The mind warper generation 4 Dimensional Warp Generator # 52 4350a
series wrist watch with z60 or better memory adapter. If in stock the
AMD Dimensional Warp Generator module containing the GRC79 induction
motor, two I80200 warp stabilizers, 256GB of SRAM, and two Analog
Devices isolinear modules, This unit also has a menu driven GUI
accessible on the front panel XID display. All in 1 units would be great
if reliable models are available</p></li>
<li><p>The special 23200 or Acme 5X24 series time transducing capacitor with
built in temporal displacement. Needed with complete
jumper/auxiliary system</p></li>
<li><p>A reliable crystal Ionizor with unlimited memory backup.</p></li>
</ol>


<p>If your vendor turns out to be reliable, I owe you $5,000.</p>

<p>Email his details to me at: <a href="mailto:powercrystals@firemail.de">powercrystals@firemail.de</a></p>

<p>Please do not reply directly back to this email as it will only be bounced back to you.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/weblog/blog/page/35/">&larr; Older</a>
    
    <a href="/weblog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/weblog/blog/page/33/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/weblog/2012/05/10/static-bloggin/">Static Bloggin</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/28/i-am-not-a-climatologist-and-neither-are-most-of-these-people/">I am not a climatologist, and neither are most of these people</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/10/looking-for-summer-interns-in-the-software-technology-group-at-ibm-tj-watson-research-center/">Looking for Summer Interns in the Software Technology Group at IBM TJ Watson Research Center</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/a-review-of-2011-personal-development-goals/">A Review of 2011 Personal Development Goals</a>
      </li>
    
      <li class="post">
        <a href="/weblog/2012/01/03/open-source-and-technology-predictions-for-2012/">Open Source and Technology Predictions for 2012</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pridkett">@pridkett</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pridkett',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/weblog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("pridkett", 4, false);
    });
  </script>
  <script src="/weblog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/pridkett" class="twitter-follow-button" data-show-count="false">Follow @pridkett</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102672530623465237388?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Patrick Wagstrom -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
